<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catch-Up Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-dark': '#4a49b1',
                        'primary-light': '#7e7de7',
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-200">
    <div class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-primary dark:bg-primary-dark text-white p-4 shadow-md">
            <div class="container mx-auto flex justify-between items-center">
                <h1 class="text-2xl font-bold">Catch-Up Planner</h1>
                <button id="toggleNav" class="md:hidden text-white">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </header>
        
        <!-- Main content -->
        <div class="flex flex-1 overflow-hidden">
            <!-- Sidebar Navigation -->
            <nav id="sidebar" class="hidden md:block w-64 bg-gray-100 dark:bg-gray-800 p-4 border-r border-gray-200 dark:border-gray-700 h-full transition-all duration-300">
                <ul class="space-y-2">
                    <li>
                        <button data-section="dashboard" class="nav-btn w-full text-left px-4 py-2 rounded-lg font-medium bg-primary text-white">
                            <i class="fas fa-home mr-2"></i> Dashboard
                        </button>
                    </li>
                    <li>
                        <button data-section="contacts" class="nav-btn w-full text-left px-4 py-2 rounded-lg font-medium hover:bg-gray-200 dark:hover:bg-gray-700">
                            <i class="fas fa-address-book mr-2"></i> Contacts
                        </button>
                    </li>
                    <li>
                        <button data-section="meetings" class="nav-btn w-full text-left px-4 py-2 rounded-lg font-medium hover:bg-gray-200 dark:hover:bg-gray-700">
                            <i class="fas fa-calendar-alt mr-2"></i> Meetings
                        </button>
                    </li>
                    <li>
                        <button data-section="notes" class="nav-btn w-full text-left px-4 py-2 rounded-lg font-medium hover:bg-gray-200 dark:hover:bg-gray-700">
                            <i class="fas fa-sticky-note mr-2"></i> Notes
                        </button>
                    </li>
                    <li>
                        <button data-section="suggestions" class="nav-btn w-full text-left px-4 py-2 rounded-lg font-medium hover:bg-gray-200 dark:hover:bg-gray-700">
                            <i class="fas fa-lightbulb mr-2"></i> Topic Ideas
                        </button>
                    </li>
                    <li>
                        <button data-section="messages" class="nav-btn w-full text-left px-4 py-2 rounded-lg font-medium hover:bg-gray-200 dark:hover:bg-gray-700">
                            <i class="fas fa-comment-dots mr-2"></i> Message Analysis
                        </button>
                    </li>
                    <li>
                        <button data-section="calendar" class="nav-btn w-full text-left px-4 py-2 rounded-lg font-medium hover:bg-gray-200 dark:hover:bg-gray-700">
                            <i class="fas fa-calendar mr-2"></i> Calendar
                        </button>
                    </li>
                </ul>
            </nav>
            
            <!-- Main content area -->
            <main class="flex-1 overflow-auto p-4">
                <!-- Dashboard Section -->
                <section id="dashboard" class="section active">
                    <h2 class="text-2xl font-bold mb-6">Dashboard</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Upcoming meetings -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4">
                            <h3 class="text-lg font-semibold mb-4 flex items-center">
                                <i class="fas fa-calendar-alt text-primary dark:text-primary-light mr-2"></i>
                                Upcoming Catch-Ups
                            </h3>
                            <div id="upcoming-meetings-list" class="space-y-3">
                                <p class="text-gray-500 dark:text-gray-400 italic">No upcoming catch-ups scheduled.</p>
                            </div>
                            <button class="mt-4 text-primary dark:text-primary-light hover:underline" data-section="meetings">
                                <i class="fas fa-plus-circle mr-1"></i> Schedule a catch-up
                            </button>
                        </div>
                        
                        <!-- Recent notes -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4">
                            <h3 class="text-lg font-semibold mb-4 flex items-center">
                                <i class="fas fa-sticky-note text-primary dark:text-primary-light mr-2"></i>
                                Recent Conversations
                            </h3>
                            <div id="recent-notes-list" class="space-y-3">
                                <p class="text-gray-500 dark:text-gray-400 italic">No recent conversation notes found.</p>
                            </div>
                            <button class="mt-4 text-primary dark:text-primary-light hover:underline" data-section="notes">
                                <i class="fas fa-search mr-1"></i> View all notes
                            </button>
                        </div>
                        
                        <!-- Contact summary -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4">
                            <h3 class="text-lg font-semibold mb-4 flex items-center">
                                <i class="fas fa-address-book text-primary dark:text-primary-light mr-2"></i>
                                Contacts
                            </h3>
                            <p id="contact-count" class="text-2xl font-bold text-primary dark:text-primary-light">0</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400">people in your network</p>
                            <button class="mt-4 text-primary dark:text-primary-light hover:underline" data-section="contacts">
                                <i class="fas fa-user-plus mr-1"></i> Add a contact
                            </button>
                        </div>
                        
                        <!-- Suggested topics -->
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-4">
                            <h3 class="text-lg font-semibold mb-4 flex items-center">
                                <i class="fas fa-lightbulb text-primary dark:text-primary-light mr-2"></i>
                                Topic Ideas
                            </h3>
                            <div id="topic-ideas-preview" class="space-y-2">
                                <p class="text-gray-500 dark:text-gray-400 italic">No topic ideas yet.</p>
                            </div>
                            <button class="mt-4 text-primary dark:text-primary-light hover:underline" data-section="suggestions">
                                <i class="fas fa-plus-circle mr-1"></i> Add topic ideas
                            </button>
                        </div>
                    </div>
                </section>
                
                <!-- Contacts Section -->
                <section id="contacts" class="section hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">Contacts</h2>
                        <button id="add-contact-btn" class="bg-primary hover:bg-primary-dark dark:bg-primary dark:hover:bg-primary-light text-white px-4 py-2 rounded-lg flex items-center">
                            <i class="fas fa-plus mr-2"></i> Add Contact
                        </button>
                    </div>
                    
                    <!-- Search bar -->
                    <div class="mb-6">
                        <div class="relative">
                            <input type="text" id="contact-search" placeholder="Search contacts..." class="w-full px-4 py-2 pl-10 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-base">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                    </div>
                    
                    <!-- Contacts list -->
                    <div id="contacts-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <p class="text-gray-500 dark:text-gray-400 italic col-span-full">No contacts added yet.</p>
                    </div>
                    
                    <!-- Add/Edit Contact Modal -->
                    <div id="contact-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg w-full max-w-md p-6">
                            <h3 id="contact-modal-title" class="text-xl font-bold mb-4">Add Contact</h3>
                            
                            <form id="contact-form" class="space-y-4">
                                <input type="hidden" id="contact-id">
                                <div>
                                    <label for="contact-name" class="block text-sm font-medium mb-1">Name</label>
                                    <input type="text" id="contact-name" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" required>
                                </div>
                                <div>
                                    <label for="contact-relationship" class="block text-sm font-medium mb-1">Relationship</label>
                                    <select id="contact-relationship" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                        <option value="Family">Family</option>
                                        <option value="Friend">Friend</option>
                                        <option value="Colleague">Colleague</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="contact-phone" class="block text-sm font-medium mb-1">Phone (optional)</label>
                                    <input type="tel" id="contact-phone" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                </div>
                                <div>
                                    <label for="contact-email" class="block text-sm font-medium mb-1">Email (optional)</label>
                                    <input type="email" id="contact-email" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                </div>
                                <div>
                                    <label for="contact-notes" class="block text-sm font-medium mb-1">Notes (optional)</label>
                                    <textarea id="contact-notes" rows="3" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base"></textarea>
                                </div>
                                
                                <div class="flex justify-end space-x-3 pt-2">
                                    <button type="button" id="cancel-contact" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg">Cancel</button>
                                    <button type="submit" class="bg-primary hover:bg-primary-dark dark:hover:bg-primary-light text-white px-4 py-2 rounded-lg">Save</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Contact Details Modal -->
                    <div id="contact-details-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg w-full max-w-md p-6">
                            <div class="flex justify-between items-start mb-4">
                                <h3 id="contact-details-name" class="text-xl font-bold"></h3>
                                <button id="close-contact-details" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            
                            <div class="space-y-4">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Relationship</p>
                                    <p id="contact-details-relationship" class="font-medium"></p>
                                </div>
                                <div id="contact-details-phone-container">
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Phone</p>
                                    <p id="contact-details-phone" class="font-medium"></p>
                                </div>
                                <div id="contact-details-email-container">
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Email</p>
                                    <p id="contact-details-email" class="font-medium"></p>
                                </div>
                                <div id="contact-details-notes-container">
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Notes</p>
                                    <p id="contact-details-notes" class=""></p>
                                </div>
                                
                                <div class="border-t border-gray-200 dark:border-gray-700 pt-4 mt-4">
                                    <h4 class="font-medium mb-2">Recent Catch-ups</h4>
                                    <div id="contact-details-meetings" class="space-y-2">
                                        <p class="text-gray-500 dark:text-gray-400 italic">No catch-ups recorded.</p>
                                    </div>
                                </div>
                                
                                <div class="flex justify-between pt-2">
                                    <button id="delete-contact" class="text-red-500 hover:text-red-700 px-3 py-1 rounded">
                                        <i class="fas fa-trash-alt mr-1"></i> Delete
                                    </button>
                                    <div class="space-x-2">
                                        <button id="edit-contact" class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 px-3 py-1 rounded">
                                            <i class="fas fa-edit mr-1"></i> Edit
                                        </button>
                                        <button id="schedule-meeting" class="bg-primary hover:bg-primary-dark dark:hover:bg-primary-light text-white px-3 py-1 rounded">
                                            <i class="fas fa-calendar-plus mr-1"></i> Schedule
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Meetings Section -->
                <section id="meetings" class="section hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">Catch-Up Meetings</h2>
                        <button id="add-meeting-btn" class="bg-primary hover:bg-primary-dark dark:bg-primary dark:hover:bg-primary-light text-white px-4 py-2 rounded-lg flex items-center">
                            <i class="fas fa-plus mr-2"></i> Schedule Catch-Up
                        </button>
                    </div>
                    
                    <!-- Meeting Tabs -->
                    <div class="mb-6 border-b border-gray-200 dark:border-gray-700">
                        <ul class="flex flex-wrap -mb-px">
                            <li class="mr-2">
                                <button id="upcoming-tab" class="meeting-tab inline-block p-4 border-b-2 rounded-t-lg active border-primary dark:border-primary-light">Upcoming</button>
                            </li>
                            <li class="mr-2">
                                <button id="past-tab" class="meeting-tab inline-block p-4 border-b-2 border-transparent rounded-t-lg hover:border-gray-300 dark:hover:border-gray-600">Past</button>
                            </li>
                        </ul>
                    </div>
                    
                    <!-- Meetings list -->
                    <div id="upcoming-meetings" class="meeting-content">
                        <div id="upcoming-meetings-container" class="space-y-4">
                            <p class="text-gray-500 dark:text-gray-400 italic">No upcoming catch-ups scheduled.</p>
                        </div>
                    </div>
                    
                    <div id="past-meetings" class="meeting-content hidden">
                        <div id="past-meetings-container" class="space-y-4">
                            <p class="text-gray-500 dark:text-gray-400 italic">No past catch-ups found.</p>
                        </div>
                    </div>
                    
                    <!-- Add/Edit Meeting Modal -->
                    <div id="meeting-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg w-full max-w-md p-6">
                            <h3 id="meeting-modal-title" class="text-xl font-bold mb-4">Schedule a Catch-Up</h3>
                            
                            <form id="meeting-form" class="space-y-4">
                                <input type="hidden" id="meeting-id">
                                
                                <div>
                                    <label for="meeting-contact" class="block text-sm font-medium mb-1">With</label>
                                    <select id="meeting-contact" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" required>
                                        <option value="">Select a contact</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label for="meeting-type" class="block text-sm font-medium mb-1">Type</label>
                                    <select id="meeting-type" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                        <option value="In-person">In-person</option>
                                        <option value="Phone">Phone call</option>
                                        <option value="Video">Video call</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label for="meeting-date" class="block text-sm font-medium mb-1">Date</label>
                                    <input type="date" id="meeting-date" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" required>
                                </div>
                                
                                <div>
                                    <label for="meeting-time" class="block text-sm font-medium mb-1">Time</label>
                                    <input type="time" id="meeting-time" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" required>
                                </div>
                                
                                <div>
                                    <label for="meeting-location" class="block text-sm font-medium mb-1">Location/Details</label>
                                    <input type="text" id="meeting-location" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                </div>
                                
                                <div>
                                    <label for="meeting-notes" class="block text-sm font-medium mb-1">Notes (optional)</label>
                                    <textarea id="meeting-notes" rows="3" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base"></textarea>
                                </div>
                                
                                <div class="flex justify-end space-x-3 pt-2">
                                    <button type="button" id="cancel-meeting" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg">Cancel</button>
                                    <button type="submit" class="bg-primary hover:bg-primary-dark dark:hover:bg-primary-light text-white px-4 py-2 rounded-lg">Save</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Meeting Details Modal -->
                    <div id="meeting-details-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg w-full max-w-md p-6">
                            <div class="flex justify-between items-start mb-4">
                                <h3 id="meeting-details-title" class="text-xl font-bold"></h3>
                                <button id="close-meeting-details" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            
                            <div class="space-y-4">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">With</p>
                                    <p id="meeting-details-contact" class="font-medium"></p>
                                </div>
                                
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Type</p>
                                    <p id="meeting-details-type" class="font-medium"></p>
                                </div>
                                
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Date & Time</p>
                                    <p id="meeting-details-datetime" class="font-medium"></p>
                                </div>
                                
                                <div id="meeting-details-location-container">
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Location/Details</p>
                                    <p id="meeting-details-location" class="font-medium"></p>
                                </div>
                                
                                <div id="meeting-details-notes-container">
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Notes</p>
                                    <p id="meeting-details-notes" class=""></p>
                                </div>
                                
                                <div id="meeting-notes-section" class="border-t border-gray-200 dark:border-gray-700 pt-4 mt-4">
                                    <h4 class="font-medium mb-2">Conversation Notes</h4>
                                    <div id="meeting-conversation-notes" class="space-y-2">
                                        <p class="text-gray-500 dark:text-gray-400 italic">No conversation notes recorded.</p>
                                    </div>
                                    <button id="add-conversation-notes" class="mt-2 text-primary dark:text-primary-light hover:underline">
                                        <i class="fas fa-plus-circle mr-1"></i> Add conversation notes
                                    </button>
                                </div>
                                
                                <div class="flex justify-between pt-2">
                                    <button id="delete-meeting" class="text-red-500 hover:text-red-700 px-3 py-1 rounded">
                                        <i class="fas fa-trash-alt mr-1"></i> Delete
                                    </button>
                                    <div class="space-x-2">
                                        <button id="edit-meeting" class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 px-3 py-1 rounded">
                                            <i class="fas fa-edit mr-1"></i> Edit
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Notes Section -->
                <section id="notes" class="section hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">Conversation Notes</h2>
                        <button id="add-note-btn" class="bg-primary hover:bg-primary-dark dark:bg-primary dark:hover:bg-primary-light text-white px-4 py-2 rounded-lg flex items-center">
                            <i class="fas fa-plus mr-2"></i> Add Notes
                        </button>
                    </div>
                    
                    <!-- Filter options -->
                    <div class="mb-6 flex flex-wrap gap-4 items-center">
                        <div class="relative w-full md:w-auto md:flex-1">
                            <input type="text" id="notes-search" placeholder="Search notes..." class="w-full px-4 py-2 pl-10 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-base">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                        
                        <div class="w-full md:w-auto">
                            <select id="notes-contact-filter" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                <option value="">All contacts</option>
                            </select>
                        </div>
                        
                        <div class="w-full md:w-auto">
                            <select id="notes-category-filter" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                <option value="">All categories</option>
                                <option value="Personal">Personal</option>
                                <option value="Work">Work</option>
                                <option value="Health">Health</option>
                                <option value="Family">Family</option>
                                <option value="Hobbies">Hobbies</option>
                                <option value="Goals">Goals</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Notes list -->
                    <div id="notes-list" class="space-y-4">
                        <p class="text-gray-500 dark:text-gray-400 italic">No conversation notes found.</p>
                    </div>
                    
                    <!-- Add/Edit Note Modal -->
                    <div id="note-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg w-full max-w-md p-6">
                            <h3 id="note-modal-title" class="text-xl font-bold mb-4">Add Conversation Notes</h3>
                            
                            <form id="note-form" class="space-y-4">
                                <input type="hidden" id="note-id">
                                
                                <div>
                                    <label for="note-contact" class="block text-sm font-medium mb-1">Contact</label>
                                    <select id="note-contact" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" required>
                                        <option value="">Select a contact</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label for="note-meeting" class="block text-sm font-medium mb-1">Related Meeting (optional)</label>
                                    <select id="note-meeting" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                        <option value="">Select a meeting</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label for="note-date" class="block text-sm font-medium mb-1">Date</label>
                                    <input type="date" id="note-date" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" required>
                                </div>
                                
                                <div>
                                    <label for="note-content" class="block text-sm font-medium mb-1">Conversation Notes</label>
                                    <textarea id="note-content" rows="5" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" required></textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium mb-2">Categories</label>
                                    <div class="space-y-2" id="note-categories">
                                        <div class="flex items-center">
                                            <input type="checkbox" id="category-personal" class="mr-2 h-4 w-4 text-primary focus:ring-primary-light">
                                            <label for="category-personal">Personal</label>
                                        </div>
                                        <div class="flex items-center">
                                            <input type="checkbox" id="category-work" class="mr-2 h-4 w-4 text-primary focus:ring-primary-light">
                                            <label for="category-work">Work</label>
                                        </div>
                                        <div class="flex items-center">
                                            <input type="checkbox" id="category-health" class="mr-2 h-4 w-4 text-primary focus:ring-primary-light">
                                            <label for="category-health">Health</label>
                                        </div>
                                        <div class="flex items-center">
                                            <input type="checkbox" id="category-family" class="mr-2 h-4 w-4 text-primary focus:ring-primary-light">
                                            <label for="category-family">Family</label>
                                        </div>
                                        <div class="flex items-center">
                                            <input type="checkbox" id="category-hobbies" class="mr-2 h-4 w-4 text-primary focus:ring-primary-light">
                                            <label for="category-hobbies">Hobbies</label>
                                        </div>
                                        <div class="flex items-center">
                                            <input type="checkbox" id="category-goals" class="mr-2 h-4 w-4 text-primary focus:ring-primary-light">
                                            <label for="category-goals">Goals</label>
                                        </div>
                                        <div class="flex items-center">
                                            <input type="checkbox" id="category-other" class="mr-2 h-4 w-4 text-primary focus:ring-primary-light">
                                            <label for="category-other">Other</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <label for="note-follow-up" class="block text-sm font-medium mb-1">Follow-up Topics/Questions</label>
                                    <textarea id="note-follow-up" rows="3" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" placeholder="Topics to discuss next time..."></textarea>
                                </div>
                                
                                <div class="flex justify-end space-x-3 pt-2">
                                    <button type="button" id="cancel-note" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg">Cancel</button>
                                    <button type="submit" class="bg-primary hover:bg-primary-dark dark:hover:bg-primary-light text-white px-4 py-2 rounded-lg">Save</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Note Details Modal -->
                    <div id="note-details-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg w-full max-w-md p-6">
                            <div class="flex justify-between items-start mb-4">
                                <h3 id="note-details-title" class="text-xl font-bold"></h3>
                                <button id="close-note-details" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            
                            <div class="space-y-4">
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Contact</p>
                                    <p id="note-details-contact" class="font-medium"></p>
                                </div>
                                
                                <div id="note-details-meeting-container" class="hidden">
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Related Meeting</p>
                                    <p id="note-details-meeting" class="font-medium"></p>
                                </div>
                                
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Date</p>
                                    <p id="note-details-date" class="font-medium"></p>
                                </div>
                                
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Categories</p>
                                    <div id="note-details-categories" class="flex flex-wrap gap-2 mt-1"></div>
                                </div>
                                
                                <div>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Conversation Notes</p>
                                    <div id="note-details-content" class="mt-1 bg-gray-50 dark:bg-gray-900 p-3 rounded-lg"></div>
                                </div>
                                
                                <div id="note-details-follow-up-container">
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Follow-up Topics/Questions</p>
                                    <div id="note-details-follow-up" class="mt-1 bg-gray-50 dark:bg-gray-900 p-3 rounded-lg"></div>
                                </div>
                                
                                <div class="flex justify-between pt-2">
                                    <button id="delete-note" class="text-red-500 hover:text-red-700 px-3 py-1 rounded">
                                        <i class="fas fa-trash-alt mr-1"></i> Delete
                                    </button>
                                    <button id="edit-note" class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 px-3 py-1 rounded">
                                        <i class="fas fa-edit mr-1"></i> Edit
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Topic Suggestions Section -->
                <section id="suggestions" class="section hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">Topic Ideas</h2>
                        <button id="add-suggestion-btn" class="bg-primary hover:bg-primary-dark dark:bg-primary dark:hover:bg-primary-light text-white px-4 py-2 rounded-lg flex items-center">
                            <i class="fas fa-plus mr-2"></i> Add New Topic
                        </button>
                    </div>
                    
                    <!-- Filter options -->
                    <div class="mb-6 flex flex-wrap gap-4 items-center">
                        <div class="relative w-full md:w-auto md:flex-1">
                            <input type="text" id="suggestions-search" placeholder="Search topics..." class="w-full px-4 py-2 pl-10 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-base">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                        </div>
                        
                        <div class="w-full md:w-auto">
                            <select id="suggestions-contact-filter" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                <option value="">All contacts</option>
                                <option value="general">General topics</option>
                            </select>
                        </div>
                        
                        <div class="w-full md:w-auto">
                            <select id="suggestions-category-filter" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                <option value="">All categories</option>
                                <option value="Personal">Personal</option>
                                <option value="Work">Work</option>
                                <option value="Health">Health</option>
                                <option value="Family">Family</option>
                                <option value="Hobbies">Hobbies</option>
                                <option value="Goals">Goals</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Topics list -->
                    <div id="suggestions-list" class="space-y-4">
                        <p class="text-gray-500 dark:text-gray-400 italic">No topic ideas found.</p>
                    </div>
                    
                    <!-- Add/Edit Topic Modal -->
                    <div id="suggestion-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
                        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg w-full max-w-md p-6">
                            <h3 id="suggestion-modal-title" class="text-xl font-bold mb-4">Add Topic Idea</h3>
                            
                            <form id="suggestion-form" class="space-y-4">
                                <input type="hidden" id="suggestion-id">
                                
                                <div>
                                    <label for="suggestion-contact" class="block text-sm font-medium mb-1">For Specific Contact</label>
                                    <select id="suggestion-contact" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                        <option value="general">General topic (for anyone)</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label for="suggestion-category" class="block text-sm font-medium mb-1">Category</label>
                                    <select id="suggestion-category" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" required>
                                        <option value="">Select a category</option>
                                        <option value="Personal">Personal</option>
                                        <option value="Work">Work</option>
                                        <option value="Health">Health</option>
                                        <option value="Family">Family</option>
                                        <option value="Hobbies">Hobbies</option>
                                        <option value="Goals">Goals</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label for="suggestion-title" class="block text-sm font-medium mb-1">Topic</label>
                                    <input type="text" id="suggestion-title" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" required>
                                </div>
                                
                                <div>
                                    <label for="suggestion-details" class="block text-sm font-medium mb-1">Details/Questions (optional)</label>
                                    <textarea id="suggestion-details" rows="3" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" placeholder="Specific questions or talking points..."></textarea>
                                </div>
                                
                                <div class="flex justify-end space-x-3 pt-2">
                                    <button type="button" id="cancel-suggestion" class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg">Cancel</button>
                                    <button type="submit" class="bg-primary hover:bg-primary-dark dark:hover:bg-primary-light text-white px-4 py-2 rounded-lg">Save</button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Generate Topics Section -->
                    <div class="mt-8 bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                        <h3 class="text-lg font-semibold mb-4">Generate Topic Ideas with AI</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-4">
                            Get AI-generated conversation topics and questions based on your previous notes and interests.
                        </p>
                        
                        <div class="space-y-4">
                            <div>
                                <label for="generate-for-contact" class="block text-sm font-medium mb-1">Generate For</label>
                                <select id="generate-for-contact" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                    <option value="general">General topics (for anyone)</option>
                                </select>
                            </div>
                            
                            <div>
                                <label for="generate-interests" class="block text-sm font-medium mb-1">Interests/Focus Areas (optional)</label>
                                <textarea id="generate-interests" rows="2" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" placeholder="E.g., travel, books, career, family"></textarea>
                            </div>
                            
                            <div>
                                <label for="generate-num" class="block text-sm font-medium mb-1">Number of Topics</label>
                                <select id="generate-num" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                    <option value="3">3 topics</option>
                                    <option value="5" selected>5 topics</option>
                                    <option value="10">10 topics</option>
                                </select>
                            </div>
                            
                            <div class="pt-2">
                                <button id="generate-topics-btn" class="w-full bg-primary hover:bg-primary-dark dark:hover:bg-primary-light text-white px-4 py-2 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-magic mr-2"></i> Generate Topics
                                </button>
                            </div>
                        </div>
                        
                        <div id="generated-topics-container" class="mt-6 hidden">
                            <h4 class="font-medium mb-3">Generated Topic Ideas</h4>
                            <div id="generated-topics-list" class="space-y-3 bg-gray-50 dark:bg-gray-900 p-4 rounded-lg">
                                <!-- Generated topics will appear here -->
                            </div>
                            <div class="mt-4 flex justify-end">
                                <button id="save-generated-topics" class="bg-primary hover:bg-primary-dark dark:hover:bg-primary-light text-white px-4 py-2 rounded-lg">
                                    Save Selected Topics
                                </button>
                            </div>
                        </div>
                        
                        <div id="topics-loading" class="mt-6 hidden">
                            <div class="flex items-center justify-center space-x-2">
                                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-primary"></div>
                                <p>Generating topics...</p>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Calendar Section -->
                <section id="calendar" class="section hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">Calendar</h2>
                        <div class="flex space-x-2">
                            <div class="relative">
                                <input type="text" id="calendar-search" placeholder="Search with # or /" class="w-full px-4 py-2 pl-10 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-base">
                                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                            </div>
                            <button id="calendar-today-btn" class="bg-primary hover:bg-primary-dark dark:bg-primary dark:hover:bg-primary-light text-white px-4 py-2 rounded-lg">
                                Today
                            </button>
                        </div>
                    </div>
                    
                    <!-- Calendar navigation -->
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-4">
                            <button id="prev-month" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <h3 id="current-month-display" class="text-xl font-semibold">August 2023</h3>
                            <button id="next-month" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        <div class="flex space-x-2">
                            <div class="flex items-center">
                                <span class="inline-block w-3 h-3 rounded-full bg-green-500 mr-1"></span>
                                <span class="text-xs">Has Notes</span>
                            </div>
                            <div class="flex items-center">
                                <span class="inline-block w-3 h-3 rounded-full bg-red-500 mr-1"></span>
                                <span class="text-xs">Follow-up</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Color legend -->
                    <div class="mb-6 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm">
                        <h4 class="text-sm font-medium mb-2">Color Coding</h4>
                        <div class="flex flex-wrap gap-2">
                            <div class="flex items-center">
                                <span class="inline-block w-4 h-4 bg-blue-200 dark:bg-blue-900 mr-1 border border-blue-400 dark:border-blue-700"></span>
                                <span class="text-xs">Video Call</span>
                            </div>
                            <div class="flex items-center">
                                <span class="inline-block w-4 h-4 bg-green-200 dark:bg-green-900 mr-1 border border-green-400 dark:border-green-700"></span>
                                <span class="text-xs">Phone Call</span>
                            </div>
                            <div class="flex items-center">
                                <span class="inline-block w-4 h-4 bg-purple-200 dark:bg-purple-900 mr-1 border border-purple-400 dark:border-purple-700"></span>
                                <span class="text-xs">In-person</span>
                            </div>
                            <div class="flex items-center ml-4">
                                <span class="inline-block w-4 h-4 bg-gray-200 dark:bg-gray-700 mr-1 border border-gray-400 dark:border-gray-600"></span>
                                <span class="text-xs">Completed</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Calendar grid -->
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden">
                        <!-- Calendar header (weekdays) -->
                        <div class="grid grid-cols-7 text-center py-2 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
                            <div class="text-sm font-medium">Sun</div>
                            <div class="text-sm font-medium">Mon</div>
                            <div class="text-sm font-medium">Tue</div>
                            <div class="text-sm font-medium">Wed</div>
                            <div class="text-sm font-medium">Thu</div>
                            <div class="text-sm font-medium">Fri</div>
                            <div class="text-sm font-medium">Sat</div>
                        </div>
                        
                        <!-- Calendar days -->
                        <div id="calendar-grid" class="grid grid-cols-7 auto-rows-fr min-h-[600px]">
                            <!-- Calendar days will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Meeting Detail Popup -->
                    <div id="calendar-meeting-popup" class="fixed hidden bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 max-w-xs z-50 transform -translate-x-1/2 border border-gray-200 dark:border-gray-700">
                        <div class="flex justify-between items-start mb-2">
                            <h4 id="popup-title" class="font-semibold text-lg"></h4>
                            <button id="close-popup" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <p id="popup-time" class="text-sm text-gray-600 dark:text-gray-400 mb-2"></p>
                        <p id="popup-contact" class="text-sm font-medium mb-2"></p>
                        <p id="popup-type" class="text-sm mb-2"></p>
                        <div id="popup-indicators" class="flex space-x-2 mt-2">
                            <!-- Indicators will be added here -->
                        </div>
                        <div class="mt-2 pt-2 border-t border-gray-200 dark:border-gray-700">
                            <button id="popup-view-details" class="text-primary dark:text-primary-light hover:underline text-sm">
                                View Details
                            </button>
                        </div>
                    </div>
                </section>
                
                <!-- Message Analysis Section -->
                <section id="messages" class="section hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold">Message Analysis</h2>
                    </div>
                    
                    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                        <h3 class="text-lg font-semibold mb-4">Analyze Text Messages</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-4">
                            Paste WhatsApp or text message conversations here to analyze and generate relevant questions for future discussions.
                        </p>
                        
                        <div class="space-y-6">
                            <div>
                                <label for="message-contact" class="block text-sm font-medium mb-1">Contact</label>
                                <select id="message-contact" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                    <option value="">Select a contact (optional)</option>
                                </select>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Select a contact to associate the analysis with, or leave blank for general analysis.</p>
                            </div>
                            
                            <div>
                                <label for="message-content" class="block text-sm font-medium mb-1">Paste Messages</label>
                                <textarea id="message-content" rows="10" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" placeholder="Paste WhatsApp, text message conversations, or any content you want to analyze..."></textarea>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="message-questions" class="block text-sm font-medium mb-1">Number of Questions</label>
                                    <select id="message-questions" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base">
                                        <option value="3">3 questions</option>
                                        <option value="5" selected>5 questions</option>
                                        <option value="10">10 questions</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label for="message-focus" class="block text-sm font-medium mb-1">Focus Area (optional)</label>
                                    <input type="text" id="message-focus" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-base" placeholder="e.g., career, family, hobbies">
                                </div>
                            </div>
                            
                            <div class="pt-2">
                                <button id="analyze-messages-btn" class="w-full bg-primary hover:bg-primary-dark dark:hover:bg-primary-light text-white px-4 py-3 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-search-plus mr-2"></i> Analyze Messages & Generate Questions
                                </button>
                            </div>
                        </div>
                        
                        <div id="message-analysis-container" class="mt-8 hidden">
                            <div class="border-t border-gray-200 dark:border-gray-700 pt-6">
                                <h4 class="font-medium text-lg mb-4">Analysis Results</h4>
                                
                                <div id="message-topics-container" class="mb-6">
                                    <h5 class="font-medium text-sm uppercase text-gray-500 dark:text-gray-400 mb-2">Key Topics Identified</h5>
                                    <div id="message-topics" class="flex flex-wrap gap-2"></div>
                                </div>
                                
                                <div id="message-questions-container">
                                    <h5 class="font-medium text-sm uppercase text-gray-500 dark:text-gray-400 mb-2">Suggested Questions</h5>
                                    <div id="message-questions-list" class="space-y-3 bg-gray-50 dark:bg-gray-900 p-4 rounded-lg"></div>
                                </div>
                                
                                <div class="mt-6 flex justify-end space-x-3">
                                    <button id="save-questions-as-notes" class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 px-4 py-2 rounded">
                                        <i class="fas fa-sticky-note mr-1"></i> Save as Note
                                    </button>
                                    <button id="save-questions-as-topics" class="bg-primary hover:bg-primary-dark dark:hover:bg-primary-light text-white px-4 py-2 rounded">
                                        <i class="fas fa-lightbulb mr-1"></i> Save as Topic Ideas
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div id="message-analysis-loading" class="mt-6 hidden">
                            <div class="flex items-center justify-center space-x-2">
                                <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-primary"></div>
                                <p>Analyzing messages...</p>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
        
        <!-- Notification popup -->
        <div id="notification" class="fixed bottom-4 right-4 bg-white dark:bg-gray-800 shadow-lg rounded-lg p-4 transform translate-y-20 opacity-0 transition-all duration-300 max-w-sm">
            <div class="flex items-start">
                <div id="notification-icon" class="text-green-500 mr-3">
                    <i class="fas fa-check-circle text-xl"></i>
                </div>
                <div class="flex-1">
                    <p id="notification-message" class="font-medium"></p>
                </div>
                <button id="close-notification" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 ml-4">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // Dark mode detection
        function setDarkMode() {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
        }
        
        setDarkMode();
        
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
        
        // Data store
        let appData = {
            contacts: [],
            meetings: [],
            notes: [],
            suggestions: [],
            nextIds: {
                contact: 1,
                meeting: 1,
                note: 1,
                suggestion: 1
            }
        };
        
        // Load from localStorage (since localStorage is not available)
        function loadData() {
            try {
                const savedData = localStorage.getItem('catchupAppData');
                if (savedData) {
                    appData = JSON.parse(savedData);
                } else {
                    // Add sample data for first-time users
                    addSampleData();
                }
            } catch (e) {
                console.log('Error loading data:', e);
                // Add sample data if loading fails
                addSampleData();
            }
        }
        
        // Save to localStorage
        function saveData() {
            try {
                localStorage.setItem('catchupAppData', JSON.stringify(appData));
            } catch (e) {
                console.log('Error saving data:', e);
                showNotification('Warning: Your data may not be saved when you close this app', 'warning');
            }
        }
        
        // Add sample data for first-time users
        function addSampleData() {
            // Sample contact
            appData.contacts.push({
                id: appData.nextIds.contact++,
                name: 'Sarah Johnson',
                relationship: 'Friend',
                phone: '555-1234',
                email: 'sarah@example.com',
                notes: 'College roommate, now lives in Seattle. Has two kids and works in marketing.'
            });
            
            // Sample meeting
            const meetingDate = new Date();
            meetingDate.setDate(meetingDate.getDate() + 7);
            
            appData.meetings.push({
                id: appData.nextIds.meeting++,
                contactId: 1,
                type: 'Video',
                date: meetingDate.toISOString().split('T')[0],
                time: '19:00',
                location: 'Zoom call',
                notes: 'Catching up after several months',
                completed: false
            });
            
            // Sample past meeting
            const pastDate = new Date();
            pastDate.setDate(pastDate.getDate() - 30);
            
            appData.meetings.push({
                id: appData.nextIds.meeting++,
                contactId: 1,
                type: 'Phone',
                date: pastDate.toISOString().split('T')[0],
                time: '14:30',
                location: '',
                notes: 'Quick check-in call',
                completed: true
            });
            
            // Sample note for the past meeting
            appData.notes.push({
                id: appData.nextIds.note++,
                contactId: 1,
                meetingId: 2,
                date: pastDate.toISOString().split('T')[0],
                content: "Sarah mentioned her daughter started soccer practice. She's planning a trip to Hawaii in the summer and might look for a new job in the fall. Seems a bit stressed about work deadlines.",
                categories: ['Personal', 'Family', 'Work'],
                followUp: "Ask about the Hawaii trip plans. See if she found any new job opportunities. Check how her daughter is enjoying soccer."
            });
            
            // Sample topic suggestions
            appData.suggestions.push({
                id: appData.nextIds.suggestion++,
                contactId: 1,
                category: 'Travel',
                title: 'Hawaii trip planning',
                details: 'Ask which islands she plans to visit. Any activities already booked? Is the whole family going?'
            });
            
            appData.suggestions.push({
                id: appData.nextIds.suggestion++,
                contactId: 'general',
                category: 'Personal',
                title: 'Recent book recommendations',
                details: 'What have they read recently that they enjoyed? Any genres they\'ve been exploring?'
            });
            
            saveData();
        }
        
        // Navigation
        function setupNavigation() {
            const sections = document.querySelectorAll('.section');
            const navButtons = document.querySelectorAll('.nav-btn');
            const toggleNavButton = document.getElementById('toggleNav');
            const sidebar = document.getElementById('sidebar');
            
            // Handle navigation button clicks
            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const targetSection = button.getAttribute('data-section');
                    
                    // Update active section
                    sections.forEach(section => {
                        section.classList.add('hidden');
                        if (section.id === targetSection) {
                            section.classList.remove('hidden');
                        }
                    });
                    
                    // Update active button
                    navButtons.forEach(btn => {
                        btn.classList.remove('bg-primary', 'text-white');
                        btn.classList.add('hover:bg-gray-200', 'dark:hover:bg-gray-700');
                    });
                    button.classList.add('bg-primary', 'text-white');
                    button.classList.remove('hover:bg-gray-200', 'dark:hover:bg-gray-700');
                    
                    // Close mobile sidebar after navigation
                    if (window.innerWidth < 768) {
                        sidebar.classList.add('hidden');
                    }
                });
            });
            
            // Handle sidebar toggle on mobile
            toggleNavButton.addEventListener('click', () => {
                sidebar.classList.toggle('hidden');
                sidebar.classList.toggle('absolute');
                sidebar.classList.toggle('z-10');
                sidebar.classList.toggle('inset-y-0');
                sidebar.classList.toggle('left-0');
            });
            
            // Add event listeners to dashboard buttons
            document.querySelectorAll('button[data-section]').forEach(button => {
                button.addEventListener('click', () => {
                    const targetSection = button.getAttribute('data-section');
                    
                    // Find and click the corresponding nav button
                    document.querySelector(`.nav-btn[data-section="${targetSection}"]`).click();
                });
            });
        }
        
        // Notification system
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationMessage = document.getElementById('notification-message');
            const notificationIcon = document.getElementById('notification-icon');
            
            notificationMessage.textContent = message;
            
            // Set icon based on type
            if (type === 'success') {
                notificationIcon.innerHTML = '<i class="fas fa-check-circle text-xl"></i>';
                notificationIcon.className = 'text-green-500 mr-3';
            } else if (type === 'error') {
                notificationIcon.innerHTML = '<i class="fas fa-exclamation-circle text-xl"></i>';
                notificationIcon.className = 'text-red-500 mr-3';
            } else if (type === 'warning') {
                notificationIcon.innerHTML = '<i class="fas fa-exclamation-triangle text-xl"></i>';
                notificationIcon.className = 'text-yellow-500 mr-3';
            } else if (type === 'info') {
                notificationIcon.innerHTML = '<i class="fas fa-info-circle text-xl"></i>';
                notificationIcon.className = 'text-blue-500 mr-3';
            }
            
            // Show notification
            notification.classList.remove('translate-y-20', 'opacity-0');
            
            // Hide after 3 seconds
            setTimeout(() => {
                notification.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }
        
        // Close notification on click
        document.getElementById('close-notification').addEventListener('click', () => {
            document.getElementById('notification').classList.add('translate-y-20', 'opacity-0');
        });
        
        // Format date in a readable format
        function formatDate(dateString) {
            const options = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }
        
        // Format date and time in a readable format
        function formatDateTime(dateString, timeString) {
            const date = new Date(dateString + 'T' + timeString);
            const dateOptions = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };
            const timeOptions = { hour: 'numeric', minute: 'numeric' };
            
            return date.toLocaleDateString(undefined, dateOptions) + ' at ' + date.toLocaleTimeString(undefined, timeOptions);
        }
        
        // Get contact by ID
        function getContactById(id) {
            return appData.contacts.find(contact => contact.id === parseInt(id));
        }
        
        // Get meeting by ID
        function getMeetingById(id) {
            return appData.meetings.find(meeting => meeting.id === parseInt(id));
        }
        
        // Get note by ID
        function getNoteById(id) {
            return appData.notes.find(note => note.id === parseInt(id));
        }
        
        // Get suggestion by ID
        function getSuggestionById(id) {
            return appData.suggestions.find(suggestion => suggestion.id === parseInt(id));
        }
        
        // Find meetings for a contact
        function getMeetingsForContact(contactId) {
            return appData.meetings.filter(meeting => meeting.contactId === parseInt(contactId));
        }
        
        // Find notes for a contact
        function getNotesForContact(contactId) {
            return appData.notes.filter(note => note.contactId === parseInt(contactId));
        }
        
        // Find notes for a meeting
        function getNotesForMeeting(meetingId) {
            return appData.notes.filter(note => note.meetingId === parseInt(meetingId));
        }
        
        // Sort meetings by date (newest first)
        function sortMeetingsByDate(meetings) {
            return [...meetings].sort((a, b) => {
                const dateA = new Date(a.date + 'T' + a.time);
                const dateB = new Date(b.date + 'T' + b.time);
                return dateB - dateA;
            });
        }
        
        // Sort notes by date (newest first)
        function sortNotesByDate(notes) {
            return [...notes].sort((a, b) => {
                return new Date(b.date) - new Date(a.date);
            });
        }
        
        // Filter upcoming meetings
        function getUpcomingMeetings() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            return appData.meetings.filter(meeting => {
                const meetingDate = new Date(meeting.date);
                meetingDate.setHours(0, 0, 0, 0);
                return meetingDate >= today && !meeting.completed;
            });
        }
        
        // Filter past meetings
        function getPastMeetings() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            return appData.meetings.filter(meeting => {
                const meetingDate = new Date(meeting.date);
                meetingDate.setHours(0, 0, 0, 0);
                return meetingDate < today || meeting.completed;
            });
        }
        
        // Populate dashboard
        function populateDashboard() {
            // Upcoming meetings
            const upcomingMeetingsContainer = document.getElementById('upcoming-meetings-list');
            const upcomingMeetings = sortMeetingsByDate(getUpcomingMeetings()).slice(0, 3);
            
            upcomingMeetingsContainer.innerHTML = '';
            
            if (upcomingMeetings.length === 0) {
                upcomingMeetingsContainer.innerHTML = '<p class="text-gray-500 dark:text-gray-400 italic">No upcoming catch-ups scheduled.</p>';
            } else {
                upcomingMeetings.forEach(meeting => {
                    const contact = getContactById(meeting.contactId);
                    const meetingDate = new Date(meeting.date + 'T' + meeting.time);
                    const isToday = new Date().toDateString() === meetingDate.toDateString();
                    
                    const meetingEl = document.createElement('div');
                    meetingEl.className = 'flex items-start p-3 bg-gray-50 dark:bg-gray-900 rounded-lg';
                    meetingEl.innerHTML = `
                        <div class="flex-shrink-0 w-12 h-12 flex items-center justify-center bg-primary bg-opacity-10 rounded-full mr-3">
                            <i class="fas ${meeting.type === 'Phone' ? 'fa-phone' : meeting.type === 'Video' ? 'fa-video' : 'fa-users'} text-primary dark:text-primary-light"></i>
                        </div>
                        <div class="flex-1">
                            <p class="font-semibold">${contact ? contact.name : 'Unknown'}</p>
                            <p class="text-sm">${meeting.type} catch-up</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400">
                                ${isToday ? 'Today' : formatDate(meeting.date)} at ${meeting.time.substring(0, 5)}
                            </p>
                        </div>
                    `;
                    
                    meetingEl.addEventListener('click', () => {
                        openMeetingDetails(meeting.id);
                    });
                    
                    upcomingMeetingsContainer.appendChild(meetingEl);
                });
            }
            
            // Recent notes
            const recentNotesContainer = document.getElementById('recent-notes-list');
            const recentNotes = sortNotesByDate(appData.notes).slice(0, 3);
            
            recentNotesContainer.innerHTML = '';
            
            if (recentNotes.length === 0) {
                recentNotesContainer.innerHTML = '<p class="text-gray-500 dark:text-gray-400 italic">No recent conversation notes found.</p>';
            } else {
                recentNotes.forEach(note => {
                    const contact = getContactById(note.contactId);
                    
                    const noteEl = document.createElement('div');
                    noteEl.className = 'p-3 bg-gray-50 dark:bg-gray-900 rounded-lg';
                    noteEl.innerHTML = `
                        <div class="flex items-center mb-2">
                            <span class="font-semibold">${contact ? contact.name : 'Unknown'}</span>
                            <span class="text-sm text-gray-500 dark:text-gray-400 ml-auto">${formatDate(note.date)}</span>
                        </div>
                        <p class="text-sm line-clamp-2">${note.content.substring(0, 100)}${note.content.length > 100 ? '...' : ''}</p>
                    `;
                    
                    noteEl.addEventListener('click', () => {
                        openNoteDetails(note.id);
                    });
                    
                    recentNotesContainer.appendChild(noteEl);
                });
            }
            
            // Contact count
            document.getElementById('contact-count').textContent = appData.contacts.length;
            
            // Topic ideas preview
            const topicIdeasContainer = document.getElementById('topic-ideas-preview');
            const topicIdeas = appData.suggestions.slice(0, 3);
            
            topicIdeasContainer.innerHTML = '';
            
            if (topicIdeas.length === 0) {
                topicIdeasContainer.innerHTML = '<p class="text-gray-500 dark:text-gray-400 italic">No topic ideas yet.</p>';
            } else {
                topicIdeas.forEach(suggestion => {
                    const contact = suggestion.contactId !== 'general' ? getContactById(suggestion.contactId) : null;
                    
                    const suggestionEl = document.createElement('div');
                    suggestionEl.className = 'p-2 bg-gray-50 dark:bg-gray-900 rounded-lg';
                    suggestionEl.innerHTML = `
                        <div class="flex items-center">
                            <span class="text-sm font-medium">${suggestion.title}</span>
                            ${contact ? `<span class="text-xs bg-gray-200 dark:bg-gray-700 px-2 py-0.5 rounded ml-auto">${contact.name}</span>` : ''}
                        </div>
                    `;
                    
                    suggestionEl.addEventListener('click', () => {
                        openSuggestionDetails(suggestion.id);
                    });
                    
                    topicIdeasContainer.appendChild(suggestionEl);
                });
            }
        }
        
        // Contacts Section
        function setupContactsSection() {
            const addContactBtn = document.getElementById('add-contact-btn');
            const contactModal = document.getElementById('contact-modal');
            const contactForm = document.getElementById('contact-form');
            const cancelContactBtn = document.getElementById('cancel-contact');
            const contactSearch = document.getElementById('contact-search');
            const closeContactDetailsBtn = document.getElementById('close-contact-details');
            const contactDetailsModal = document.getElementById('contact-details-modal');
            const editContactBtn = document.getElementById('edit-contact');
            const deleteContactBtn = document.getElementById('delete-contact');
            const scheduleContactBtn = document.getElementById('schedule-meeting');
            
            // Populate contacts list
            function populateContactsList() {
                const contactsContainer = document.getElementById('contacts-list');
                contactsContainer.innerHTML = '';
                
                const searchTerm = contactSearch.value.toLowerCase();
                let filteredContacts = appData.contacts;
                
                if (searchTerm) {
                    filteredContacts = filteredContacts.filter(contact => 
                        contact.name.toLowerCase().includes(searchTerm) || 
                        (contact.email && contact.email.toLowerCase().includes(searchTerm)) ||
                        (contact.notes && contact.notes.toLowerCase().includes(searchTerm))
                    );
                }
                
                if (filteredContacts.length === 0) {
                    contactsContainer.innerHTML = '<p class="text-gray-500 dark:text-gray-400 italic col-span-full">No contacts found.</p>';
                    return;
                }
                
                filteredContacts.forEach(contact => {
                    const contactEl = document.createElement('div');
                    contactEl.className = 'bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow';
                    contactEl.innerHTML = `
                        <div class="flex items-center mb-2">
                            <div class="w-10 h-10 rounded-full bg-primary bg-opacity-10 flex items-center justify-center mr-3">
                                <span class="text-primary dark:text-primary-light font-semibold">${contact.name.substring(0, 1).toUpperCase()}</span>
                            </div>
                            <div>
                                <h3 class="font-semibold text-lg">${contact.name}</h3>
                                <p class="text-sm text-gray-500 dark:text-gray-400">${contact.relationship}</p>
                            </div>
                        </div>
                        ${contact.phone ? `<p class="text-sm mb-1"><i class="fas fa-phone mr-2 text-gray-400"></i>${contact.phone}</p>` : ''}
                        ${contact.email ? `<p class="text-sm mb-1"><i class="fas fa-envelope mr-2 text-gray-400"></i>${contact.email}</p>` : ''}
                        ${contact.notes ? `<p class="text-sm text-gray-500 dark:text-gray-400 mt-2 line-clamp-2">${contact.notes}</p>` : ''}
                    `;
                    
                    contactEl.addEventListener('click', () => {
                        openContactDetails(contact.id);
                    });
                    
                    contactsContainer.appendChild(contactEl);
                });
            }
            
            // Open contact details modal
            function openContactDetails(contactId) {
                const contact = getContactById(contactId);
                if (!contact) return;
                
                document.getElementById('contact-details-name').textContent = contact.name;
                document.getElementById('contact-details-relationship').textContent = contact.relationship;
                
                // Phone
                const phoneContainer = document.getElementById('contact-details-phone-container');
                if (contact.phone) {
                    phoneContainer.classList.remove('hidden');
                    document.getElementById('contact-details-phone').textContent = contact.phone;
                } else {
                    phoneContainer.classList.add('hidden');
                }
                
                // Email
                const emailContainer = document.getElementById('contact-details-email-container');
                if (contact.email) {
                    emailContainer.classList.remove('hidden');
                    document.getElementById('contact-details-email').textContent = contact.email;
                } else {
                    emailContainer.classList.add('hidden');
                }
                
                // Notes
                const notesContainer = document.getElementById('contact-details-notes-container');
                if (contact.notes) {
                    notesContainer.classList.remove('hidden');
                    document.getElementById('contact-details-notes').textContent = contact.notes;
                } else {
                    notesContainer.classList.add('hidden');
                }
                
                // Recent meetings
                const meetingsContainer = document.getElementById('contact-details-meetings');
                const contactMeetings = sortMeetingsByDate(getMeetingsForContact(contactId)).slice(0, 3);
                
                meetingsContainer.innerHTML = '';
                
                if (contactMeetings.length === 0) {
                    meetingsContainer.innerHTML = '<p class="text-gray-500 dark:text-gray-400 italic">No catch-ups recorded.</p>';
                } else {
                    contactMeetings.forEach(meeting => {
                        const meetingEl = document.createElement('div');
                        meetingEl.className = 'text-sm p-2 bg-gray-50 dark:bg-gray-900 rounded flex justify-between items-center';
                        meetingEl.innerHTML = `
                            <span>${meeting.type} catch-up</span>
                            <span class="text-gray-500 dark:text-gray-400">${formatDate(meeting.date)}</span>
                        `;
                        
                        meetingEl.addEventListener('click', () => {
                            contactDetailsModal.classList.add('hidden');
                            openMeetingDetails(meeting.id);
                        });
                        
                        meetingsContainer.appendChild(meetingEl);
                    });
                }
                
                // Set up edit button
                editContactBtn.onclick = () => {
                    contactDetailsModal.classList.add('hidden');
                    openContactModal('edit', contactId);
                };
                
                // Set up delete button
                deleteContactBtn.onclick = () => {
                    if (confirm(`Are you sure you want to delete ${contact.name}? This will also delete all associated meetings and notes.`)) {
                        // Delete all notes and meetings for this contact
                        appData.notes = appData.notes.filter(note => note.contactId !== contactId);
                        appData.meetings = appData.meetings.filter(meeting => meeting.contactId !== contactId);
                        
                        // Delete contact
                        appData.contacts = appData.contacts.filter(c => c.id !== contactId);
                        saveData();
                        
                        contactDetailsModal.classList.add('hidden');
                        populateContactsList();
                        populateDashboard();
                        populateMeetingContactSelect();
                        populateNoteContactSelect();
                        populateSuggestionContactSelect();
                        
                        showNotification('Contact deleted successfully');
                    }
                };
                
                // Set up schedule meeting button
                scheduleContactBtn.onclick = () => {
                    contactDetailsModal.classList.add('hidden');
                    openMeetingModal('add', null, contactId);
                };
                
                contactDetailsModal.classList.remove('hidden');
            }
            
            // Open the contact modal (for add or edit)
            function openContactModal(mode = 'add', contactId = null) {
                const titleEl = document.getElementById('contact-modal-title');
                const idInput = document.getElementById('contact-id');
                const nameInput = document.getElementById('contact-name');
                const relationshipSelect = document.getElementById('contact-relationship');
                const phoneInput = document.getElementById('contact-phone');
                const emailInput = document.getElementById('contact-email');
                const notesInput = document.getElementById('contact-notes');
                
                // Reset form
                contactForm.reset();
                
                if (mode === 'edit' && contactId) {
                    const contact = getContactById(contactId);
                    if (!contact) return;
                    
                    titleEl.textContent = 'Edit Contact';
                    idInput.value = contact.id;
                    nameInput.value = contact.name;
                    relationshipSelect.value = contact.relationship;
                    phoneInput.value = contact.phone || '';
                    emailInput.value = contact.email || '';
                    notesInput.value = contact.notes || '';
                } else {
                    titleEl.textContent = 'Add Contact';
                    idInput.value = '';
                }
                
                contactModal.classList.remove('hidden');
            }
            
            // Add contact button click
            addContactBtn.addEventListener('click', () => {
                openContactModal('add');
            });
            
            // Cancel button click
            cancelContactBtn.addEventListener('click', () => {
                contactModal.classList.add('hidden');
            });
            
            // Close contact details
            closeContactDetailsBtn.addEventListener('click', () => {
                contactDetailsModal.classList.add('hidden');
            });
            
            // Contact search
            contactSearch.addEventListener('input', () => {
                populateContactsList();
            });
            
            // Contact form submit
            contactForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const idInput = document.getElementById('contact-id');
                const nameInput = document.getElementById('contact-name');
                const relationshipSelect = document.getElementById('contact-relationship');
                const phoneInput = document.getElementById('contact-phone');
                const emailInput = document.getElementById('contact-email');
                const notesInput = document.getElementById('contact-notes');
                
                const contactData = {
                    name: nameInput.value.trim(),
                    relationship: relationshipSelect.value,
                    phone: phoneInput.value.trim(),
                    email: emailInput.value.trim(),
                    notes: notesInput.value.trim()
                };
                
                if (idInput.value) {
                    // Edit existing contact
                    const contactId = parseInt(idInput.value);
                    const contactIndex = appData.contacts.findIndex(c => c.id === contactId);
                    
                    if (contactIndex !== -1) {
                        contactData.id = contactId;
                        appData.contacts[contactIndex] = contactData;
                        showNotification('Contact updated successfully');
                    }
                } else {
                    // Add new contact
                    contactData.id = appData.nextIds.contact++;
                    appData.contacts.push(contactData);
                    showNotification('Contact added successfully');
                }
                
                saveData();
                contactModal.classList.add('hidden');
                populateContactsList();
                populateDashboard();
                populateMeetingContactSelect();
                populateNoteContactSelect();
                populateSuggestionContactSelect();
            });
            
            // Initialize contacts list
            populateContactsList();
        }
        
        // Meetings Section
        function setupMeetingsSection() {
            const addMeetingBtn = document.getElementById('add-meeting-btn');
            const meetingModal = document.getElementById('meeting-modal');
            const meetingForm = document.getElementById('meeting-form');
            const cancelMeetingBtn = document.getElementById('cancel-meeting');
            const upcomingTab = document.getElementById('upcoming-tab');
            const pastTab = document.getElementById('past-tab');
            const upcomingMeetingsContent = document.getElementById('upcoming-meetings');
            const pastMeetingsContent = document.getElementById('past-meetings');
            const closeMeetingDetailsBtn = document.getElementById('close-meeting-details');
            const meetingDetailsModal = document.getElementById('meeting-details-modal');
            const editMeetingBtn = document.getElementById('edit-meeting');
            const deleteMeetingBtn = document.getElementById('delete-meeting');
            const addConversationNotesBtn = document.getElementById('add-conversation-notes');
            
            // Populate contact select in meeting form
            function populateMeetingContactSelect() {
                const contactSelect = document.getElementById('meeting-contact');
                contactSelect.innerHTML = '<option value="">Select a contact</option>';
                
                appData.contacts.forEach(contact => {
                    const option = document.createElement('option');
                    option.value = contact.id;
                    option.textContent = contact.name;
                    contactSelect.appendChild(option);
                });
            }
            
            // Populate upcoming meetings
            function populateUpcomingMeetings() {
                const container = document.getElementById('upcoming-meetings-container');
                container.innerHTML = '';
                
                const upcomingMeetings = sortMeetingsByDate(getUpcomingMeetings());
                
                if (upcomingMeetings.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 italic">No upcoming catch-ups scheduled.</p>';
                    return;
                }
                
                upcomingMeetings.forEach(meeting => {
                    const contact = getContactById(meeting.contactId);
                    const meetingDate = new Date(meeting.date + 'T' + meeting.time);
                    const isToday = new Date().toDateString() === meetingDate.toDateString();
                    
                    const meetingEl = document.createElement('div');
                    meetingEl.className = 'bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4 hover:shadow-md transition-shadow';
                    meetingEl.innerHTML = `
                        <div class="flex items-start">
                            <div class="flex-shrink-0 w-12 h-12 flex items-center justify-center bg-primary bg-opacity-10 rounded-full mr-3">
                                <i class="fas ${meeting.type === 'Phone' ? 'fa-phone' : meeting.type === 'Video' ? 'fa-video' : 'fa-users'} text-primary dark:text-primary-light"></i>
                            </div>
                            <div class="flex-1">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-semibold text-lg">${contact ? contact.name : 'Unknown'}</h3>
                                    <span class="text-sm bg-primary bg-opacity-10 text-primary dark:text-primary-light px-2 py-0.5 rounded">
                                        ${meeting.type}
                                    </span>
                                </div>
                                <p class="text-sm text-gray-500 dark:text-gray-400">
                                    ${isToday ? 'Today' : formatDate(meeting.date)} at ${meeting.time.substring(0, 5)}
                                </p>
                                ${meeting.location ? `<p class="text-sm mt-2"><i class="fas fa-map-marker-alt mr-2 text-gray-400"></i>${meeting.location}</p>` : ''}
                                ${meeting.notes ? `<p class="text-sm text-gray-500 dark:text-gray-400 mt-2 border-t border-gray-100 dark:border-gray-700 pt-2">${meeting.notes}</p>` : ''}
                            </div>
                        </div>
                    `;
                    
                    meetingEl.addEventListener('click', () => {
                        openMeetingDetails(meeting.id);
                    });
                    
                    container.appendChild(meetingEl);
                });
            }
            
            // Populate past meetings
            function populatePastMeetings() {
                const container = document.getElementById('past-meetings-container');
                container.innerHTML = '';
                
                const pastMeetings = sortMeetingsByDate(getPastMeetings());
                
                if (pastMeetings.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 dark:text-gray-400 italic">No past catch-ups found.</p>';
                    return;
                }
                
                pastMeetings.forEach(meeting => {
                    const contact = getContactById(meeting.contactId);
                    
                    const meetingEl = document.createElement('div');
                    meetingEl.className = 'bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4 hover:shadow-md transition-shadow';
                    meetingEl.innerHTML = `
                        <div class="flex items-start">
                            <div class="flex-shrink-0 w-12 h-12 flex items-center justify-center bg-gray-100 dark:bg-gray-700 rounded-full mr-3">
                                <i class="fas ${meeting.type === 'Phone' ? 'fa-phone' : meeting.type === 'Video' ? 'fa-video' : 'fa-users'} text-gray-500 dark:text-gray-400"></i>
                            </div>
                            <div class="flex-1">
                                <div class="flex justify-between items-start">
                                    <h3 class="font-semibold text-lg">${contact ? contact.name : 'Unknown'}</h3>
                                    <span class="text-sm bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 px-2 py-0.5 rounded">
                                        ${meeting.type}
                                    </span>
                                </div>
                                <p class="text-sm text-gray-500 dark:text-gray-400">
                                    ${formatDate(meeting.date)} at ${meeting.time.substring(0, 5)}
                                </p>
                                
                                ${meeting.location ? `<p class="text-sm mt-2"><i class="fas fa-map-marker-alt mr-2 text-gray-400"></i>${meeting.location}</p>` : ''}
                                
                                <div class="mt-2 border-t border-gray-100 dark:border-gray-700 pt-2">
                                    ${hasNotesForMeeting(meeting.id) ? 
                                        '<span class="text-xs bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-100 px-2 py-0.5 rounded">Notes recorded</span>' : 
                                        '<span class="text-xs bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-100 px-2 py-0.5 rounded">No notes</span>'}
                                </div>
                            </div>
                        </div>
                    `;
                    
                    meetingEl.addEventListener('click', () => {
                        openMeetingDetails(meeting.id);
                    });
                    
                    container.appendChild(meetingEl);
                });
            }
            
            // Check if a meeting has notes
            function hasNotesForMeeting(meetingId) {
                return appData.notes.some(note => note.meetingId === meetingId);
            }
            
            // Open meeting details modal
            function openMeetingDetails(meetingId) {
                const meeting = getMeetingById(meetingId);
                if (!meeting) return;
                
                const contact = getContactById(meeting.contactId);
                
                document.getElementById('meeting-details-title').textContent = `${meeting.type} Catch-Up`;
                document.getElementById('meeting-details-contact').textContent = contact ? contact.name : 'Unknown';
                document.getElementById('meeting-details-type').textContent = meeting.type;
                document.getElementById('meeting-details-datetime').textContent = formatDateTime(meeting.date, meeting.time);
                
                // Location
                const locationContainer = document.getElementById('meeting-details-location-container');
                if (meeting.location) {
                    locationContainer.classList.remove('hidden');
                    document.getElementById('meeting-details-location').textContent = meeting.location;
                } else {
                    locationContainer.classList.add('hidden');
                }
                
                // Notes
                const notesContainer = document.getElementById('meeting-details-notes-container');
                if (meeting.notes) {
                    notesContainer.classList.remove('hidden');
                    document.getElementById('meeting-details-notes').textContent = meeting.notes;
                } else {
                    notesContainer.classList.add('hidden');
                }
                
                // Conversation notes
                const meetingNotes = getNotesForMeeting(meetingId);
                const conversationNotesContainer = document.getElementById('meeting-conversation-notes');
                
                conversationNotesContainer.innerHTML = '';
                
                if (meetingNotes.length === 0) {
                    conversationNotesContainer.innerHTML = '<p class="text-gray-500 dark:text-gray-400 italic">No conversation notes recorded.</p>';
                } else {
                    meetingNotes.forEach(note => {
                        const noteEl = document.createElement('div');
                        noteEl.className = 'p-2 bg-gray-50 dark:bg-gray-900 rounded';
                        
                        // Create category badges
                        const categoryBadges = note.categories.map(category => 
                            `<span class="inline-block text-xs bg-gray-200 dark:bg-gray-700 px-1.5 py-0.5 rounded mr-1 mb-1">${category}</span>`
                        ).join('');
                        
                        noteEl.innerHTML = `
                            <div class="flex flex-wrap mb-1">
                                ${categoryBadges}
                            </div>
                            <p class="text-sm line-clamp-2">${note.content.substring(0, 100)}${note.content.length > 100 ? '...' : ''}</p>
                        `;
                        
                        noteEl.addEventListener('click', () => {
                            meetingDetailsModal.classList.add('hidden');
                            openNoteDetails(note.id);
                        });
                        
                        conversationNotesContainer.appendChild(noteEl);
                    });
                }
                
                // Set up edit button
                editMeetingBtn.onclick = () => {
                    meetingDetailsModal.classList.add('hidden');
                    openMeetingModal('edit', meetingId);
                };
                
                // Set up delete button
                deleteMeetingBtn.onclick = () => {
                    if (confirm('Are you sure you want to delete this catch-up?')) {
                        // Update notes to remove meeting reference
                        appData.notes.forEach(note => {
                            if (note.meetingId === meetingId) {
                                note.meetingId = null;
                            }
                        });
                        
                        // Delete meeting
                        appData.meetings = appData.meetings.filter(m => m.id !== meetingId);
                        saveData();
                        
                        meetingDetailsModal.classList.add('hidden');
                        populateUpcomingMeetings();
                        populatePastMeetings();
                        populateDashboard();
                        
                        showNotification('Catch-up deleted successfully');
                    }
                };
                
                // Set up add conversation notes button
                addConversationNotesBtn.onclick = () => {
                    meetingDetailsModal.classList.add('hidden');
                    openNoteModal('add', null, meeting.contactId, meetingId);
                };
                
                // Show/hide sections based on whether meeting is past or upcoming
                const notesSection = document.getElementById('meeting-notes-section');
                const meetingDate = new Date(meeting.date + 'T' + meeting.time);
                const isPast = meetingDate < new Date() || meeting.completed;
                
                notesSection.style.display = isPast ? 'block' : 'none';
                
                meetingDetailsModal.classList.remove('hidden');
            }
            
            // Open the meeting modal (for add or edit)
            function openMeetingModal(mode = 'add', meetingId = null, presetContactId = null) {
                const titleEl = document.getElementById('meeting-modal-title');
                const idInput = document.getElementById('meeting-id');
                const contactSelect = document.getElementById('meeting-contact');
                const typeSelect = document.getElementById('meeting-type');
                const dateInput = document.getElementById('meeting-date');
                const timeInput = document.getElementById('meeting-time');
                const locationInput = document.getElementById('meeting-location');
                const notesInput = document.getElementById('meeting-notes');
                
                // Reset form
                meetingForm.reset();
                
                // Set today as the minimum date
                const today = new Date().toISOString().split('T')[0];
                dateInput.min = today;
                
                if (mode === 'edit' && meetingId) {
                    const meeting = getMeetingById(meetingId);
                    if (!meeting) return;
                    
                    titleEl.textContent = 'Edit Catch-Up';
                    idInput.value = meeting.id;
                    contactSelect.value = meeting.contactId;
                    typeSelect.value = meeting.type;
                    dateInput.value = meeting.date;
                    timeInput.value = meeting.time;
                    locationInput.value = meeting.location || '';
                    notesInput.value = meeting.notes || '';
                    
                    // If meeting is in the past, don't restrict date
                    const meetingDate = new Date(meeting.date);
                    if (meetingDate < new Date()) {
                        dateInput.removeAttribute('min');
                    }
                } else {
                    titleEl.textContent = 'Schedule a Catch-Up';
                    idInput.value = '';
                    
                    // Set default time (current time rounded to next 30 min)
                    const now = new Date();
                    const minutes = Math.ceil(now.getMinutes() / 30) * 30;
                    now.setMinutes(minutes);
                    now.setSeconds(0);
                    timeInput.value = now.toTimeString().substring(0, 5);
                    
                    // Set today's date
                    dateInput.value = today;
                    
                    // Set preset contact if provided
                    if (presetContactId) {
                        contactSelect.value = presetContactId;
                    }
                }
                
                meetingModal.classList.remove('hidden');
            }
            
            // Add meeting button click
            addMeetingBtn.addEventListener('click', () => {
                openMeetingModal('add');
            });
            
            // Cancel button click
            cancelMeetingBtn.addEventListener('click', () => {
                meetingModal.classList.add('hidden');
            });
            
            // Close meeting details
            closeMeetingDetailsBtn.addEventListener('click', () => {
                meetingDetailsModal.classList.add('hidden');
            });
            
            // Meeting form submit
            meetingForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const idInput = document.getElementById('meeting-id');
                const contactSelect = document.getElementById('meeting-contact');
                const typeSelect = document.getElementById('meeting-type');
                const dateInput = document.getElementById('meeting-date');
                const timeInput = document.getElementById('meeting-time');
                const locationInput = document.getElementById('meeting-location');
                const notesInput = document.getElementById('meeting-notes');
                
                const meetingData = {
                    contactId: parseInt(contactSelect.value),
                    type: typeSelect.value,
                    date: dateInput.value,
                    time: timeInput.value,
                    location: locationInput.value.trim(),
                    notes: notesInput.value.trim(),
                    completed: false
                };
                
                // Check if meeting is in the past
                const meetingDate = new Date(meetingData.date + 'T' + meetingData.time);
                if (meetingDate < new Date()) {
                    meetingData.completed = true;
                }
                
                if (idInput.value) {
                    // Edit existing meeting
                    const meetingId = parseInt(idInput.value);
                    const meetingIndex = appData.meetings.findIndex(m => m.id === meetingId);
                    
                    if (meetingIndex !== -1) {
                        meetingData.id = meetingId;
                        appData.meetings[meetingIndex] = meetingData;
                        showNotification('Catch-up updated successfully');
                    }
                } else {
                    // Add new meeting
                    meetingData.id = appData.nextIds.meeting++;
                    appData.meetings.push(meetingData);
                    showNotification('Catch-up scheduled successfully');
                }
                
                saveData();
                meetingModal.classList.add('hidden');
                populateUpcomingMeetings();
                populatePastMeetings();
                populateDashboard();
                populateNoteMeetingSelect();
            });
            
            // Tab switching
            upcomingTab.addEventListener('click', () => {
                pastTab.classList.remove('active', 'border-primary', 'dark:border-primary-light');
                upcomingTab.classList.add('active', 'border-primary', 'dark:border-primary-light');
                
                pastMeetingsContent.classList.add('hidden');
                upcomingMeetingsContent.classList.remove('hidden');
            });
            
            pastTab.addEventListener('click', () => {
                upcomingTab.classList.remove('active', 'border-primary', 'dark:border-primary-light');
                pastTab.classList.add('active', 'border-primary', 'dark:border-primary-light');
                
                upcomingMeetingsContent.classList.add('hidden');
                pastMeetingsContent.classList.remove('hidden');
            });
            
            // Initialize
            populateMeetingContactSelect();
            populateUpcomingMeetings();
            populatePastMeetings();
        }
        
        // Notes Section
        function setupNotesSection() {
            const addNoteBtn = document.getElementById('add-note-btn');
            const noteModal = document.getElementById('note-modal');
            const noteForm = document.getElementById('note-form');
            const cancelNoteBtn = document.getElementById('cancel-note');
            const notesSearch = document.getElementById('notes-search');
            const notesContactFilter = document.getElementById('notes-contact-filter');
            const notesCategoryFilter = document.getElementById('notes-category-filter');
            const closeNoteDetailsBtn = document.getElementById('close-note-details');
            const noteDetailsModal = document.getElementById('note-details-modal');
            const editNoteBtn = document.getElementById('edit-note');
            const deleteNoteBtn = document.getElementById('delete-note');
            
            // Populate contact select in note form
            function populateNoteContactSelect() {
                const contactSelect = document.getElementById('note-contact');
                contactSelect.innerHTML = '<option value="">Select a contact</option>';
                
                appData.contacts.forEach(contact => {
                    const option = document.createElement('option');
                    option.value = contact.id;
                    option.textContent = contact.name;
                    contactSelect.appendChild(option);
                });
                
                // Also populate the filter
                const filterSelect = document.getElementById('notes-contact-filter');
                filterSelect.innerHTML = '<option value="">All contacts</option>';
                
                appData.contacts.forEach(contact => {
                    const option = document.createElement('option');
                    option.value = contact.id;
                    option.textContent = contact.name;
                    filterSelect.appendChild(option);
                });
            }
            
            // Populate meeting select in note form based on selected contact
            function populateNoteMeetingSelect(contactId = null) {
                const meetingSelect = document.getElementById('note-meeting');
                meetingSelect.innerHTML = '<option value="">Select a meeting</option>';
                
                if (!contactId) return;
                
                const contactMeetings = getMeetingsForContact(contactId);
                
                if (contactMeetings.length > 0) {
                    // Add a separator
                    const separator = document.createElement('option');
                    separator.disabled = true;
                    separator.textContent = '---';
                    meetingSelect.appendChild(separator);
                    
                    // Add meetings in reverse chronological order
                    sortMeetingsByDate(contactMeetings).forEach(meeting => {
                        const option = document.createElement('option');
                        option.value = meeting.id;
                        const meetingDate = formatDate(meeting.date);
                        option.textContent = `${meeting.type} on ${meetingDate}`;
                        meetingSelect.appendChild(option);
                    });
                }
            }
            
            // Populate notes list
            function populateNotesList() {
                const notesContainer = document.getElementById('notes-list');
                notesContainer.innerHTML = '';
                
                // Apply filters
                const searchTerm = notesSearch.value.toLowerCase();
                const contactFilter = notesContactFilter.value;
                const categoryFilter = notesCategoryFilter.value;
                
                let filteredNotes = appData.notes;
                
                if (searchTerm) {
                    filteredNotes = filteredNotes.filter(note => 
                        note.content.toLowerCase().includes(searchTerm) || 
                        (note.followUp && note.followUp.toLowerCase().includes(searchTerm))
                    );
                }
                
                if (contactFilter) {
                    filteredNotes = filteredNotes.filter(note => note.contactId === parseInt(contactFilter));
                }
                
                if (categoryFilter) {
                    filteredNotes = filteredNotes.filter(note => note.categories.includes(categoryFilter));
                }
                
                // Sort by date (newest first)
                filteredNotes = sortNotesByDate(filteredNotes);
                
                if (filteredNotes.length === 0) {
                    notesContainer.innerHTML = '<p class="text-gray-500 dark:text-gray-400 italic">No conversation notes found.</p>';
                    return;
                }
                
                filteredNotes.forEach(note => {
                    const contact = getContactById(note.contactId);
                    const meeting = note.meetingId ? getMeetingById(note.meetingId) : null;
                    
                    const noteEl = document.createElement('div');
                    noteEl.className = 'bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4 hover:shadow-md transition-shadow';
                    
                    // Create category badges
                    const categoryBadges = note.categories.map(category => 
                        `<span class="inline-block text-xs bg-gray-200 dark:bg-gray-700 px-1.5 py-0.5 rounded mr-1 mb-1">${category}</span>`
                    ).join('');
                    
                    noteEl.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-semibold">${contact ? contact.name : 'Unknown'}</h3>
                            <span class="text-sm text-gray-500 dark:text-gray-400">${formatDate(note.date)}</span>
                        </div>
                        
                        ${meeting ? `<p class="text-sm text-gray-500 dark:text-gray-400 mb-2">${meeting.type} catch-up</p>` : ''}
                        
                        <div class="flex flex-wrap mb-2">
                            ${categoryBadges}
                        </div>
                        
                        <p class="text-sm line-clamp-3">${note.content}</p>
                        
                        ${note.followUp ? `
                            <div class="mt-2 pt-2 border-t border-gray-100 dark:border-gray-700">
                                <p class="text-sm font-medium">Follow-up Topics:</p>
                                <p class="text-sm text-gray-600 dark:text-gray-300 line-clamp-2">${note.followUp}</p>
                            </div>
                        ` : ''}
                    `;
                    
                    noteEl.addEventListener('click', () => {
                        openNoteDetails(note.id);
                    });
                    
                    notesContainer.appendChild(noteEl);
                });
            }
            
            // Open note details modal
            function openNoteDetails(noteId) {
                const note = getNoteById(noteId);
                if (!note) return;
                
                const contact = getContactById(note.contactId);
                const meeting = note.meetingId ? getMeetingById(note.meetingId) : null;
                
                document.getElementById('note-details-title').textContent = 'Conversation Notes';
                document.getElementById('note-details-contact').textContent = contact ? contact.name : 'Unknown';
                document.getElementById('note-details-date').textContent = formatDate(note.date);
                
                // Meeting
                const meetingContainer = document.getElementById('note-details-meeting-container');
                if (meeting) {
                    meetingContainer.classList.remove('hidden');
                    document.getElementById('note-details-meeting').textContent = `${meeting.type} catch-up on ${formatDate(meeting.date)}`;
                } else {
                    meetingContainer.classList.add('hidden');
                }
                
                // Categories
                const categoriesContainer = document.getElementById('note-details-categories');
                categoriesContainer.innerHTML = '';
                
                note.categories.forEach(category => {
                    const categoryBadge = document.createElement('span');
                    categoryBadge.className = 'inline-block text-xs bg-gray-200 dark:bg-gray-700 px-2 py-0.5 rounded';
                    categoryBadge.textContent = category;
                    categoriesContainer.appendChild(categoryBadge);
                });
                
                // Content
                document.getElementById('note-details-content').textContent = note.content;
                
                // Follow-up
                const followUpContainer = document.getElementById('note-details-follow-up-container');
                if (note.followUp) {
                    followUpContainer.classList.remove('hidden');
                    document.getElementById('note-details-follow-up').textContent = note.followUp;
                } else {
                    followUpContainer.classList.add('hidden');
                }
                
                // Set up edit button
                editNoteBtn.onclick = () => {
                    noteDetailsModal.classList.add('hidden');
                    openNoteModal('edit', noteId);
                };
                
                // Set up delete button
                deleteNoteBtn.onclick = () => {
                    if (confirm('Are you sure you want to delete these notes?')) {
                        appData.notes = appData.notes.filter(n => n.id !== noteId);
                        saveData();
                        
                        noteDetailsModal.classList.add('hidden');
                        populateNotesList();
                        populateDashboard();
                        
                        showNotification('Notes deleted successfully');
                    }
                };
                
                noteDetailsModal.classList.remove('hidden');
            }
            
            // Open the note modal (for add or edit)
            function openNoteModal(mode = 'add', noteId = null, presetContactId = null, presetMeetingId = null) {
                const titleEl = document.getElementById('note-modal-title');
                const idInput = document.getElementById('note-id');
                const contactSelect = document.getElementById('note-contact');
                const meetingSelect = document.getElementById('note-meeting');
                const dateInput = document.getElementById('note-date');
                const contentInput = document.getElementById('note-content');
                const followUpInput = document.getElementById('note-follow-up');
                
                // Reset form
                noteForm.reset();
                
                // Reset categories
                document.querySelectorAll('#note-categories input[type="checkbox"]').forEach(checkbox => {
                    checkbox.checked = false;
                });
                
                // Set today as the default date
                const today = new Date().toISOString().split('T')[0];
                
                if (mode === 'edit' && noteId) {
                    const note = getNoteById(noteId);
                    if (!note) return;
                    
                    titleEl.textContent = 'Edit Conversation Notes';
                    idInput.value = note.id;
                    contactSelect.value = note.contactId;
                    populateNoteMeetingSelect(note.contactId);
                    meetingSelect.value = note.meetingId || '';
                    dateInput.value = note.date;
                    contentInput.value = note.content;
                    followUpInput.value = note.followUp || '';
                    
                    // Set categories
                    note.categories.forEach(category => {
                        const checkbox = document.getElementById(`category-${category.toLowerCase()}`);
                        if (checkbox) checkbox.checked = true;
                    });
                } else {
                    titleEl.textContent = 'Add Conversation Notes';
                    idInput.value = '';
                    dateInput.value = today;
                    
                    // Set preset contact if provided
                    if (presetContactId) {
                        contactSelect.value = presetContactId;
                        populateNoteMeetingSelect(presetContactId);
                        
                        // Set preset meeting if provided
                        if (presetMeetingId) {
                            meetingSelect.value = presetMeetingId;
                        }
                    }
                }
                
                noteModal.classList.remove('hidden');
            }
            
            // Add note button click
            addNoteBtn.addEventListener('click', () => {
                openNoteModal('add');
            });
            
            // Cancel button click
            cancelNoteBtn.addEventListener('click', () => {
                noteModal.classList.add('hidden');
            });
            
            // Close note details
            closeNoteDetailsBtn.addEventListener('click', () => {
                noteDetailsModal.classList.add('hidden');
            });
            
            // Contact select change
            document.getElementById('note-contact').addEventListener('change', function() {
                if (this.value) {
                    populateNoteMeetingSelect(parseInt(this.value));
                } else {
                    document.getElementById('note-meeting').innerHTML = '<option value="">Select a meeting</option>';
                }
            });
            
            // Filters change
            notesSearch.addEventListener('input', populateNotesList);
            notesContactFilter.addEventListener('change', populateNotesList);
            notesCategoryFilter.addEventListener('change', populateNotesList);
            
            // Note form submit
            noteForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const idInput = document.getElementById('note-id');
                const contactSelect = document.getElementById('note-contact');
                const meetingSelect = document.getElementById('note-meeting');
                const dateInput = document.getElementById('note-date');
                const contentInput = document.getElementById('note-content');
                const followUpInput = document.getElementById('note-follow-up');
                
                // Get selected categories
                const selectedCategories = [];
                document.querySelectorAll('#note-categories input[type="checkbox"]:checked').forEach(checkbox => {
                    const categoryName = checkbox.id.replace('category-', '');
                    selectedCategories.push(categoryName.charAt(0).toUpperCase() + categoryName.slice(1));
                });
                
                // Require at least one category
                if (selectedCategories.length === 0) {
                    showNotification('Please select at least one category', 'warning');
                    return;
                }
                
                const noteData = {
                    contactId: parseInt(contactSelect.value),
                    meetingId: meetingSelect.value ? parseInt(meetingSelect.value) : null,
                    date: dateInput.value,
                    content: contentInput.value.trim(),
                    categories: selectedCategories,
                    followUp: followUpInput.value.trim()
                };
                
                if (idInput.value) {
                    // Edit existing note
                    const noteId = parseInt(idInput.value);
                    const noteIndex = appData.notes.findIndex(n => n.id === noteId);
                    
                    if (noteIndex !== -1) {
                        noteData.id = noteId;
                        appData.notes[noteIndex] = noteData;
                        showNotification('Notes updated successfully');
                    }
                } else {
                    // Add new note
                    noteData.id = appData.nextIds.note++;
                    appData.notes.push(noteData);
                    
                    // If this is for a meeting, mark the meeting as completed
                    if (noteData.meetingId) {
                        const meetingIndex = appData.meetings.findIndex(m => m.id === noteData.meetingId);
                        if (meetingIndex !== -1) {
                            appData.meetings[meetingIndex].completed = true;
                        }
                    }
                    
                    showNotification('Notes added successfully');
                }
                
                saveData();
                noteModal.classList.add('hidden');
                populateNotesList();
                populateDashboard();
                populateUpcomingMeetings();
                populatePastMeetings();
            });
            
            // Initialize
            populateNoteContactSelect();
            populateNotesList();
        }
        
        // Topic Suggestions Section
        function setupSuggestionsSection() {
            const addSuggestionBtn = document.getElementById('add-suggestion-btn');
            const suggestionModal = document.getElementById('suggestion-modal');
            const suggestionForm = document.getElementById('suggestion-form');
            const cancelSuggestionBtn = document.getElementById('cancel-suggestion');
            const suggestionsSearch = document.getElementById('suggestions-search');
            const suggestionsContactFilter = document.getElementById('suggestions-contact-filter');
            const suggestionsCategoryFilter = document.getElementById('suggestions-category-filter');
            const generateTopicsBtn = document.getElementById('generate-topics-btn');
            const saveGeneratedTopicsBtn = document.getElementById('save-generated-topics');
            
            // Populate contact select in suggestion form
            function populateSuggestionContactSelect() {
                const contactSelect = document.getElementById('suggestion-contact');
                contactSelect.innerHTML = '<option value="general">General topic (for anyone)</option>';
                
                appData.contacts.forEach(contact => {
                    const option = document.createElement('option');
                    option.value = contact.id;
                    option.textContent = contact.name;
                    contactSelect.appendChild(option);
                });
                
                // Also populate the filter
                const filterSelect = document.getElementById('suggestions-contact-filter');
                filterSelect.innerHTML = '<option value="">All contacts</option><option value="general">General topics</option>';
                
                appData.contacts.forEach(contact => {
                    const option = document.createElement('option');
                    option.value = contact.id;
                    option.textContent = contact.name;
                    filterSelect.appendChild(option);
                });
                
                // Also populate the generate-for select
                const generateForSelect = document.getElementById('generate-for-contact');
                generateForSelect.innerHTML = '<option value="general">General topics (for anyone)</option>';
                
                appData.contacts.forEach(contact => {
                    const option = document.createElement('option');
                    option.value = contact.id;
                    option.textContent = contact.name;
                    generateForSelect.appendChild(option);
                });
            }
            
            // Populate suggestions list
            function populateSuggestionsList() {
                const suggestionsContainer = document.getElementById('suggestions-list');
                suggestionsContainer.innerHTML = '';
                
                // Apply filters
                const searchTerm = suggestionsSearch.value.toLowerCase();
                const contactFilter = suggestionsContactFilter.value;
                const categoryFilter = suggestionsCategoryFilter.value;
                
                let filteredSuggestions = appData.suggestions;
                
                if (searchTerm) {
                    filteredSuggestions = filteredSuggestions.filter(suggestion => 
                        suggestion.title.toLowerCase().includes(searchTerm) || 
                        (suggestion.details && suggestion.details.toLowerCase().includes(searchTerm))
                    );
                }
                
                if (contactFilter) {
                    filteredSuggestions = filteredSuggestions.filter(suggestion => suggestion.contactId.toString() === contactFilter);
                }
                
                if (categoryFilter) {
                    filteredSuggestions = filteredSuggestions.filter(suggestion => suggestion.category === categoryFilter);
                }
                
                if (filteredSuggestions.length === 0) {
                    suggestionsContainer.innerHTML = '<p class="text-gray-500 dark:text-gray-400 italic">No topic ideas found.</p>';
                    return;
                }
                
                filteredSuggestions.forEach(suggestion => {
                    const contact = suggestion.contactId !== 'general' ? getContactById(suggestion.contactId) : null;
                    
                    const suggestionEl = document.createElement('div');
                    suggestionEl.className = 'bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4 hover:shadow-md transition-shadow';
                    suggestionEl.innerHTML = `
                        <div class="flex items-start justify-between">
                            <div>
                                <div class="flex items-center gap-2">
                                    <h3 class="font-semibold">${suggestion.title}</h3>
                                    <span class="text-xs bg-gray-200 dark:bg-gray-700 px-2 py-0.5 rounded">${suggestion.category}</span>
                                </div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
                                    ${contact ? `For: ${contact.name}` : 'General topic'}
                                </p>
                            </div>
                            <button class="delete-suggestion text-gray-400 hover:text-red-500" data-id="${suggestion.id}">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                        ${suggestion.details ? `<p class="text-sm mt-2">${suggestion.details}</p>` : ''}
                    `;
                    
                    const deleteBtn = suggestionEl.querySelector('.delete-suggestion');
                    deleteBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const suggestionId = parseInt(deleteBtn.getAttribute('data-id'));
                        
                        if (confirm('Are you sure you want to delete this topic idea?')) {
                            appData.suggestions = appData.suggestions.filter(s => s.id !== suggestionId);
                            saveData();
                            populateSuggestionsList();
                            populateDashboard();
                            showNotification('Topic idea deleted successfully');
                        }
                    });
                    
                    suggestionEl.addEventListener('click', (e) => {
                        if (e.target !== deleteBtn && !deleteBtn.contains(e.target)) {
                            openSuggestionModal('edit', suggestion.id);
                        }
                    });
                    
                    suggestionsContainer.appendChild(suggestionEl);
                });
            }
            
            // Open the suggestion modal (for add or edit)
            function openSuggestionModal(mode = 'add', suggestionId = null) {
                const titleEl = document.getElementById('suggestion-modal-title');
                const idInput = document.getElementById('suggestion-id');
                const contactSelect = document.getElementById('suggestion-contact');
                const categorySelect = document.getElementById('suggestion-category');
                const titleInput = document.getElementById('suggestion-title');
                const detailsInput = document.getElementById('suggestion-details');
                
                // Reset form
                suggestionForm.reset();
                
                if (mode === 'edit' && suggestionId) {
                    const suggestion = getSuggestionById(suggestionId);
                    if (!suggestion) return;
                    
                    titleEl.textContent = 'Edit Topic Idea';
                    idInput.value = suggestion.id;
                    contactSelect.value = suggestion.contactId;
                    categorySelect.value = suggestion.category;
                    titleInput.value = suggestion.title;
                    detailsInput.value = suggestion.details || '';
                } else {
                    titleEl.textContent = 'Add Topic Idea';
                    idInput.value = '';
                }
                
                suggestionModal.classList.remove('hidden');
            }
            
            // Open suggestion details (edit modal)
            function openSuggestionDetails(suggestionId) {
                openSuggestionModal('edit', suggestionId);
            }
            
            // Add suggestion button click
            addSuggestionBtn.addEventListener('click', () => {
                openSuggestionModal('add');
            });
            
            // Cancel button click
            cancelSuggestionBtn.addEventListener('click', () => {
                suggestionModal.classList.add('hidden');
            });
            
            // Filters change
            suggestionsSearch.addEventListener('input', populateSuggestionsList);
            suggestionsContactFilter.addEventListener('change', populateSuggestionsList);
            suggestionsCategoryFilter.addEventListener('change', populateSuggestionsList);
            
            // Suggestion form submit
            suggestionForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const idInput = document.getElementById('suggestion-id');
                const contactSelect = document.getElementById('suggestion-contact');
                const categorySelect = document.getElementById('suggestion-category');
                const titleInput = document.getElementById('suggestion-title');
                const detailsInput = document.getElementById('suggestion-details');
                
                const suggestionData = {
                    contactId: contactSelect.value,
                    category: categorySelect.value,
                    title: titleInput.value.trim(),
                    details: detailsInput.value.trim()
                };
                
                if (idInput.value) {
                    // Edit existing suggestion
                    const suggestionId = parseInt(idInput.value);
                    const suggestionIndex = appData.suggestions.findIndex(s => s.id === suggestionId);
                    
                    if (suggestionIndex !== -1) {
                        suggestionData.id = suggestionId;
                        appData.suggestions[suggestionIndex] = suggestionData;
                        showNotification('Topic idea updated successfully');
                    }
                } else {
                    // Add new suggestion
                    suggestionData.id = appData.nextIds.suggestion++;
                    appData.suggestions.push(suggestionData);
                    showNotification('Topic idea added successfully');
                }
                
                saveData();
                suggestionModal.classList.add('hidden');
                populateSuggestionsList();
                populateDashboard();
            });
            
            // Generate topics button click
            generateTopicsBtn.addEventListener('click', async () => {
                const generateForContact = document.getElementById('generate-for-contact').value;
                const generateInterests = document.getElementById('generate-interests').value.trim();
                const generateNum = parseInt(document.getElementById('generate-num').value);
                
                // Show loading state
                document.getElementById('topics-loading').classList.remove('hidden');
                document.getElementById('generated-topics-container').classList.add('hidden');
                
                try {
                    // Prepare prompt for Claude
                    let prompt = `@Claude-3.7-Sonnet Please generate ${generateNum} interesting conversation topics`;
                    
                    if (generateForContact !== 'general') {
                        const contact = getContactById(parseInt(generateForContact));
                        prompt += ` for talking with my ${contact.relationship.toLowerCase()} named ${contact.name}`;
                        
                        // Include recent notes about this contact
                        const contactNotes = getNotesForContact(parseInt(generateForContact));
                        if (contactNotes.length > 0) {
                            prompt += `. Based on previous conversations, here's what I know about them:\n\n`;
                            const latestNotes = sortNotesByDate(contactNotes).slice(0, 3);
                            latestNotes.forEach((note, index) => {
                                prompt += `Conversation ${index + 1} (${note.date}):\n${note.content}\n\n`;
                            });
                        }
                    } else {
                        prompt += ` that would be good for deepening connections with friends and family`;
                    }
                    
                    if (generateInterests) {
                        prompt += `. Focus on these interests or areas: ${generateInterests}`;
                    }
                    
                    // Request specific format for easy parsing
                    prompt += `. 

Provide ONLY raw JSON in your response with no explanations, additional text, or code block formatting (no \`\`\`). Return a JSON array with ${generateNum} objects, each with "title" (the topic), "category" (like Personal, Work, etc), and "details" (2-3 specific questions about this topic) fields.`;
                    
                    // Register a handler for Claude's response
                    window.Poe.registerHandler("generate-topics-handler", (result) => {
                        // Hide loading when we get a response
                        document.getElementById('topics-loading').classList.add('hidden');
                        
                        if (result.status === "error") {
                            showNotification("Error generating topics", "error");
                            return;
                        }
                        
                        if (result.status === "complete") {
                            const responseText = result.responses[0].content;
                            
                            try {
                                // Parse the JSON response
                                const parsedTopics = JSON.parse(responseText);
                                
                                if (Array.isArray(parsedTopics) && parsedTopics.length > 0) {
                                    displayGeneratedTopics(parsedTopics, generateForContact);
                                } else {
                                    throw new Error("Invalid response format");
                                }
                            } catch (error) {
                                console.log("Error parsing topics: ", error);
                                console.log("Response text: ", responseText);
                                showNotification("Error processing generated topics", "error");
                            }
                        }
                    });
                    
                    // Send the prompt to Claude
                    await window.Poe.sendUserMessage(prompt, {
                        handler: "generate-topics-handler",
                        stream: false,
                        openChat: false
                    });
                    
                } catch (err) {
                    document.getElementById('topics-loading').classList.add('hidden');
                    showNotification("Error: " + err.message, "error");
                }
            });
            
            // Display generated topics
            function displayGeneratedTopics(topics, contactId) {
                const topicsContainer = document.getElementById('generated-topics-list');
                topicsContainer.innerHTML = '';
                
                topics.forEach((topic, index) => {
                    const topicEl = document.createElement('div');
                    topicEl.className = 'border border-gray-200 dark:border-gray-700 rounded p-3 bg-white dark:bg-gray-800';
                    
                    topicEl.innerHTML = `
                        <div class="flex items-center mb-2">
                            <input type="checkbox" id="generated-topic-${index}" class="mr-2 h-4 w-4 text-primary focus:ring-primary-light" checked>
                            <label for="generated-topic-${index}" class="font-medium">${topic.title}</label>
                            <span class="ml-auto text-xs bg-gray-200 dark:bg-gray-700 px-2 py-0.5 rounded">${topic.category}</span>
                        </div>
                        <p class="text-sm">${topic.details}</p>
                    `;
                    
                    topicsContainer.appendChild(topicEl);
                });
                
                // Store topics for saving later
                topicsContainer.dataset.topics = JSON.stringify(topics);
                topicsContainer.dataset.contactId = contactId;
                
                // Show the container
                document.getElementById('generated-topics-container').classList.remove('hidden');
            }
            
            // Save generated topics button click
            saveGeneratedTopicsBtn.addEventListener('click', () => {
                const topicsContainer = document.getElementById('generated-topics-list');
                const topicsData = JSON.parse(topicsContainer.dataset.topics);
                const contactId = topicsContainer.dataset.contactId;
                
                let savedCount = 0;
                
                topicsContainer.querySelectorAll('input[type="checkbox"]:checked').forEach((checkbox) => {
                    const index = parseInt(checkbox.id.replace('generated-topic-', ''));
                    const topic = topicsData[index];
                    
                    if (topic) {
                        const suggestionData = {
                            id: appData.nextIds.suggestion++,
                            contactId: contactId,
                            category: topic.category,
                            title: topic.title,
                            details: topic.details
                        };
                        
                        appData.suggestions.push(suggestionData);
                        savedCount++;
                    }
                });
                
                if (savedCount > 0) {
                    saveData();
                    populateSuggestionsList();
                    populateDashboard();
                    
                    document.getElementById('generated-topics-container').classList.add('hidden');
                    showNotification(`Saved ${savedCount} topic ideas successfully`);
                } else {
                    showNotification('No topics selected to save', 'warning');
                }
            });
            
            // Initialize
            populateSuggestionContactSelect();
            populateSuggestionsList();
        }
        
        // Message Analysis Section
        function setupMessageAnalysisSection() {
            // Get DOM elements
            const messageContactSelect = document.getElementById('message-contact');
            const messageContent = document.getElementById('message-content');
            const messageQuestions = document.getElementById('message-questions');
            const messageFocus = document.getElementById('message-focus');
            const analyzeMessagesBtn = document.getElementById('analyze-messages-btn');
            const messageAnalysisContainer = document.getElementById('message-analysis-container');
            const messageAnalysisLoading = document.getElementById('message-analysis-loading');
            const messageTopics = document.getElementById('message-topics');
            const messageQuestionsList = document.getElementById('message-questions-list');
            const saveQuestionsAsNotes = document.getElementById('save-questions-as-notes');
            const saveQuestionsAsTopics = document.getElementById('save-questions-as-topics');
            
            // Populate contact select in message form
            function populateMessageContactSelect() {
                messageContactSelect.innerHTML = '<option value="">Select a contact (optional)</option>';
                
                appData.contacts.forEach(contact => {
                    const option = document.createElement('option');
                    option.value = contact.id;
                    option.textContent = contact.name;
                    messageContactSelect.appendChild(option);
                });
            }
            
            // Analyze messages button click
            analyzeMessagesBtn.addEventListener('click', async () => {
                // Validate input
                if (!messageContent.value.trim()) {
                    showNotification('Please paste some message content to analyze', 'warning');
                    return;
                }
                
                // Show loading state
                messageAnalysisLoading.classList.remove('hidden');
                messageAnalysisContainer.classList.add('hidden');
                
                try {
                    // Get values
                    const contactId = messageContactSelect.value;
                    const content = messageContent.value.trim();
                    const numQuestions = parseInt(messageQuestions.value);
                    const focusArea = messageFocus.value.trim();
                    
                    // Prepare prompt for Claude
                    let prompt = `@Claude-3.7-Sonnet I'm going to share some text messages or conversation content. Please analyze this content and identify: 
1. The main topics discussed
2. ${numQuestions} thoughtful questions I could ask in a future conversation to deepen the connection based on this content`;
                    
                    if (contactId) {
                        const contact = getContactById(parseInt(contactId));
                        prompt += `. This is a conversation with my ${contact.relationship.toLowerCase()} named ${contact.name}`;
                    }
                    
                    if (focusArea) {
                        prompt += `. Please focus particularly on topics related to: ${focusArea}`;
                    }
                    
                    prompt += `.

Here's the conversation content:
"""
${content}
"""

Provide ONLY raw JSON in your response with no explanations, additional text, or code block formatting (no \`\`\`). Return a JSON object with two properties:
1. "topics": An array of strings representing the main topics identified (5-8 topics)
2. "questions": An array of ${numQuestions} objects, each with "title" (brief topic of the question) and "question" (the full, thoughtfully phrased question)`;
                    
                    // Register a handler for Claude's response
                    window.Poe.registerHandler("analyze-messages-handler", (result) => {
                        // Hide loading when we get a response
                        messageAnalysisLoading.classList.add('hidden');
                        
                        if (result.status === "error") {
                            showNotification("Error analyzing messages", "error");
                            return;
                        }
                        
                        if (result.status === "complete") {
                            const responseText = result.responses[0].content;
                            
                            try {
                                // Parse the JSON response
                                const parsedResponse = JSON.parse(responseText);
                                
                                if (parsedResponse.topics && parsedResponse.questions) {
                                    displayMessageAnalysis(parsedResponse, contactId);
                                } else {
                                    throw new Error("Invalid response format");
                                }
                            } catch (error) {
                                console.log("Error parsing analysis: ", error);
                                console.log("Response text: ", responseText);
                                showNotification("Error processing analysis results", "error");
                            }
                        }
                    });
                    
                    // Send the prompt to Claude
                    await window.Poe.sendUserMessage(prompt, {
                        handler: "analyze-messages-handler",
                        stream: false,
                        openChat: false
                    });
                    
                } catch (err) {
                    messageAnalysisLoading.classList.add('hidden');
                    showNotification("Error: " + err.message, "error");
                }
            });
            
            // Display message analysis results
            function displayMessageAnalysis(analysis, contactId) {
                // Display topics
                messageTopics.innerHTML = '';
                
                if (analysis.topics && analysis.topics.length > 0) {
                    analysis.topics.forEach(topic => {
                        const topicEl = document.createElement('span');
                        topicEl.className = 'bg-primary bg-opacity-10 text-primary dark:text-primary-light px-3 py-1 rounded-full text-sm';
                        topicEl.textContent = topic;
                        messageTopics.appendChild(topicEl);
                    });
                }
                
                // Display questions
                messageQuestionsList.innerHTML = '';
                
                if (analysis.questions && analysis.questions.length > 0) {
                    analysis.questions.forEach((item, index) => {
                        const questionEl = document.createElement('div');
                        questionEl.className = 'p-3 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700';
                        
                        questionEl.innerHTML = `
                            <div class="flex items-center mb-1">
                                <input type="checkbox" id="question-${index}" class="mr-2 h-4 w-4 text-primary focus:ring-primary-light" checked>
                                <label for="question-${index}" class="font-medium">${item.title}</label>
                            </div>
                            <p class="text-sm text-gray-700 dark:text-gray-300">${item.question}</p>
                        `;
                        
                        messageQuestionsList.appendChild(questionEl);
                    });
                }
                
                // Store analysis for saving later
                messageQuestionsList.dataset.analysis = JSON.stringify(analysis);
                messageQuestionsList.dataset.contactId = contactId || '';
                
                // Show the container
                messageAnalysisContainer.classList.remove('hidden');
            }
            
            // Save questions as notes button click
            saveQuestionsAsNotes.addEventListener('click', () => {
                try {
                    const analysis = JSON.parse(messageQuestionsList.dataset.analysis);
                    const contactId = messageQuestionsList.dataset.contactId;
                    
                    if (!contactId) {
                        showNotification('Please select a contact to save as notes', 'warning');
                        return;
                    }
                    
                    // Collect selected questions
                    const selectedQuestions = [];
                    messageQuestionsList.querySelectorAll('input[type="checkbox"]:checked').forEach((checkbox, index) => {
                        if (analysis.questions[index]) {
                            selectedQuestions.push(analysis.questions[index]);
                        }
                    });
                    
                    if (selectedQuestions.length === 0) {
                        showNotification('No questions selected to save', 'warning');
                        return;
                    }
                    
                    // Format the questions as note content
                    const today = new Date().toISOString().split('T')[0];
                    const content = "Message analysis results:\n\n" + 
                                    selectedQuestions.map(q => `- ${q.question}`).join('\n\n');
                    
                    // Add a new note
                    const noteData = {
                        id: appData.nextIds.note++,
                        contactId: parseInt(contactId),
                        meetingId: null,
                        date: today,
                        content: content,
                        categories: ['Personal', 'Other'],
                        followUp: selectedQuestions.map(q => q.question).join('\n\n')
                    };
                    
                    appData.notes.push(noteData);
                    saveData();
                    
                    // Clear the message content and results
                    messageContent.value = '';
                    messageAnalysisContainer.classList.add('hidden');
                    
                    showNotification('Questions saved as conversation note', 'success');
                    
                } catch (error) {
                    console.log("Error saving as notes: ", error);
                    showNotification("Error saving questions as notes", "error");
                }
            });
            
            // Save questions as topics button click
            saveQuestionsAsTopics.addEventListener('click', () => {
                try {
                    const analysis = JSON.parse(messageQuestionsList.dataset.analysis);
                    const contactId = messageQuestionsList.dataset.contactId || 'general';
                    
                    // Collect selected questions
                    const selectedQuestions = [];
                    messageQuestionsList.querySelectorAll('input[type="checkbox"]:checked').forEach((checkbox, index) => {
                        if (analysis.questions[index]) {
                            selectedQuestions.push(analysis.questions[index]);
                        }
                    });
                    
                    if (selectedQuestions.length === 0) {
                        showNotification('No questions selected to save', 'warning');
                        return;
                    }
                    
                    // Save each selected question as a topic
                    selectedQuestions.forEach(question => {
                        const suggestionData = {
                            id: appData.nextIds.suggestion++,
                            contactId: contactId,
                            category: 'Personal', // Default category
                            title: question.title,
                            details: question.question
                        };
                        
                        appData.suggestions.push(suggestionData);
                    });
                    
                    saveData();
                    
                    // Clear the message content and results
                    messageContent.value = '';
                    messageAnalysisContainer.classList.add('hidden');
                    
                    showNotification(`${selectedQuestions.length} questions saved as topic ideas`, 'success');
                    
                } catch (error) {
                    console.log("Error saving as topics: ", error);
                    showNotification("Error saving questions as topics", "error");
                }
            });
            
            // Initialize
            populateMessageContactSelect();
        }
        
        // Calendar Section
        function setupCalendarSection() {
            const calendarGrid = document.getElementById('calendar-grid');
            const currentMonthDisplay = document.getElementById('current-month-display');
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');
            const todayBtn = document.getElementById('calendar-today-btn');
            const calendarSearch = document.getElementById('calendar-search');
            const meetingPopup = document.getElementById('calendar-meeting-popup');
            const closePopupBtn = document.getElementById('close-popup');
            const popupViewDetailsBtn = document.getElementById('popup-view-details');
            
            let currentDate = new Date();
            let currentMonth = currentDate.getMonth();
            let currentYear = currentDate.getFullYear();
            let selectedMeetingId = null;
            
            // Render the calendar for the current month
            function renderCalendar() {
                const firstDay = new Date(currentYear, currentMonth, 1);
                const lastDay = new Date(currentYear, currentMonth + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startingDayOfWeek = firstDay.getDay(); // 0 = Sunday, 1 = Monday, etc.
                
                // Update month display
                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                currentMonthDisplay.textContent = `${monthNames[currentMonth]} ${currentYear}`;
                
                // Clear the grid
                calendarGrid.innerHTML = '';
                
                // Add empty cells for days before the 1st of the month
                for (let i = 0; i < startingDayOfWeek; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.className = 'border border-gray-100 dark:border-gray-800 bg-gray-50 dark:bg-gray-900';
                    calendarGrid.appendChild(emptyCell);
                }
                
                // Add cells for each day of the month
                for (let day = 1; day <= daysInMonth; day++) {
                    const dateObj = new Date(currentYear, currentMonth, day);
                    const cell = document.createElement('div');
                    cell.className = 'border border-gray-200 dark:border-gray-700 p-1 min-h-[100px] relative';
                    
                    // Highlight today
                    const today = new Date();
                    if (dateObj.getDate() === today.getDate() && 
                        dateObj.getMonth() === today.getMonth() && 
                        dateObj.getFullYear() === today.getFullYear()) {
                        cell.classList.add('bg-blue-50', 'dark:bg-blue-900', 'dark:bg-opacity-20');
                    }
                    
                    // Date number
                    const dateNumber = document.createElement('div');
                    dateNumber.className = 'text-sm font-medium p-1 sticky top-0 bg-white dark:bg-gray-800 z-10';
                    dateNumber.textContent = day;
                    cell.appendChild(dateNumber);
                    
                    // Container for meetings
                    const meetingsContainer = document.createElement('div');
                    meetingsContainer.className = 'space-y-1 mt-1';
                    cell.appendChild(meetingsContainer);
                    
                    // Find meetings for this day
                    const meetingsOnDay = appData.meetings.filter(meeting => {
                        const meetingDate = new Date(meeting.date);
                        return meetingDate.getDate() === day && 
                               meetingDate.getMonth() === currentMonth && 
                               meetingDate.getFullYear() === currentYear;
                    });
                    
                    // Add meetings to the cell
                    meetingsOnDay.forEach(meeting => {
                        const meetingEl = createMeetingElement(meeting);
                        meetingsContainer.appendChild(meetingEl);
                    });
                    
                    calendarGrid.appendChild(cell);
                }
            }
            
            // Create a meeting element for the calendar
            function createMeetingElement(meeting) {
                const meetingEl = document.createElement('div');
                const contact = getContactById(meeting.contactId);
                const hasNotes = appData.notes.some(note => note.meetingId === meeting.id);
                const hasFollowUp = appData.notes.some(note => note.meetingId === meeting.id && note.followUp);
                
                // Set background color based on meeting type and completion status
                let bgColorClass = 'bg-purple-200 dark:bg-purple-900 border-purple-400 dark:border-purple-700'; // Default for in-person
                
                if (meeting.type === 'Phone') {
                    bgColorClass = 'bg-green-200 dark:bg-green-900 border-green-400 dark:border-green-700';
                } else if (meeting.type === 'Video') {
                    bgColorClass = 'bg-blue-200 dark:bg-blue-900 border-blue-400 dark:border-blue-700';
                }
                
                // If completed, override with gray
                if (meeting.completed) {
                    bgColorClass = 'bg-gray-200 dark:bg-gray-700 border-gray-400 dark:border-gray-600';
                }
                
                meetingEl.className = `text-xs p-1 rounded border flex items-center justify-between ${bgColorClass} ${meeting.completed ? 'opacity-70' : ''}`;
                
                // Create main content
                const mainContent = document.createElement('div');
                mainContent.className = 'flex-1 truncate';
                mainContent.textContent = `${meeting.time.substring(0, 5)} ${contact ? contact.name : 'Unknown'}`;
                
                // Create indicators container
                const indicators = document.createElement('div');
                indicators.className = 'flex ml-1';
                
                // Add note indicator if meeting has notes
                if (hasNotes) {
                    const noteIndicator = document.createElement('span');
                    noteIndicator.className = 'w-2 h-2 rounded-full bg-green-500 ml-0.5';
                    noteIndicator.title = 'Has notes';
                    indicators.appendChild(noteIndicator);
                }
                
                // Add follow-up indicator if meeting has follow-up items
                if (hasFollowUp) {
                    const followUpIndicator = document.createElement('span');
                    followUpIndicator.className = 'w-2 h-2 rounded-full bg-red-500 ml-0.5';
                    followUpIndicator.title = 'Has follow-up items';
                    indicators.appendChild(followUpIndicator);
                }
                
                meetingEl.appendChild(mainContent);
                meetingEl.appendChild(indicators);
                
                // Add click event to show popup
                meetingEl.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showMeetingPopup(meeting, e);
                });
                
                return meetingEl;
            }
            
            // Show the meeting popup
            function showMeetingPopup(meeting, event) {
                selectedMeetingId = meeting.id;
                const contact = getContactById(meeting.contactId);
                const hasNotes = appData.notes.some(note => note.meetingId === meeting.id);
                const hasFollowUp = appData.notes.some(note => note.meetingId === meeting.id && note.followUp);
                
                // Set popup content
                document.getElementById('popup-title').textContent = `${meeting.type} Catch-Up`;
                document.getElementById('popup-time').textContent = `${formatDate(meeting.date)} at ${meeting.time.substring(0, 5)}`;
                document.getElementById('popup-contact').textContent = contact ? contact.name : 'Unknown';
                document.getElementById('popup-type').textContent = meeting.completed ? 'Completed' : 'Scheduled';
                
                // Set indicators
                const indicatorsContainer = document.getElementById('popup-indicators');
                indicatorsContainer.innerHTML = '';
                
                if (hasNotes) {
                    const noteIndicator = document.createElement('div');
                    noteIndicator.className = 'flex items-center';
                    noteIndicator.innerHTML = '<span class="w-3 h-3 rounded-full bg-green-500 mr-1"></span><span class="text-xs">Notes</span>';
                    indicatorsContainer.appendChild(noteIndicator);
                }
                
                if (hasFollowUp) {
                    const followUpIndicator = document.createElement('div');
                    followUpIndicator.className = 'flex items-center';
                    followUpIndicator.innerHTML = '<span class="w-3 h-3 rounded-full bg-red-500 mr-1"></span><span class="text-xs">Follow-up</span>';
                    indicatorsContainer.appendChild(followUpIndicator);
                }
                
                // Position the popup near the event target
                const rect = event.target.getBoundingClientRect();
                meetingPopup.style.top = `${rect.bottom + window.scrollY + 10}px`;
                meetingPopup.style.left = `${rect.left + window.scrollX + (rect.width / 2)}px`;
                
                // Show the popup
                meetingPopup.classList.remove('hidden');
            }
            
            // Hide the meeting popup
            function hideMeetingPopup() {
                meetingPopup.classList.add('hidden');
                selectedMeetingId = null;
            }
            
            // Search functionality
            function searchCalendar(query) {
                // If search is empty, just show the regular calendar
                if (!query) {
                    renderCalendar();
                    return;
                }
                
                // Clear the grid
                calendarGrid.innerHTML = '';
                
                // Check if it's a tag search
                const isHashtag = query.startsWith('#');
                const isSlash = query.startsWith('/');
                
                // Remove the # or / prefix for searching
                if (isHashtag || isSlash) {
                    query = query.substring(1).toLowerCase();
                }
                
                // Filter meetings based on search type
                let filteredMeetings = [];
                
                if (isHashtag) {
                    // Search for categories or topics
                    filteredMeetings = appData.meetings.filter(meeting => {
                        // Check meeting notes for categories
                        const meetingNotes = appData.notes.filter(note => note.meetingId === meeting.id);
                        
                        return meetingNotes.some(note => 
                            note.categories.some(category => category.toLowerCase().includes(query)) ||
                            (note.followUp && note.followUp.toLowerCase().includes(query)) ||
                            (note.content && note.content.toLowerCase().includes(query))
                        ) || 
                        (meeting.notes && meeting.notes.toLowerCase().includes(query)) ||
                        (meeting.type.toLowerCase().includes(query));
                    });
                } else if (isSlash) {
                    // Search by contact or location
                    filteredMeetings = appData.meetings.filter(meeting => {
                        const contact = getContactById(meeting.contactId);
                        return (contact && contact.name.toLowerCase().includes(query)) ||
                               (meeting.location && meeting.location.toLowerCase().includes(query));
                    });
                } else {
                    // Regular search - check all fields
                    filteredMeetings = appData.meetings.filter(meeting => {
                        const contact = getContactById(meeting.contactId);
                        const meetingNotes = appData.notes.filter(note => note.meetingId === meeting.id);
                        
                        return (contact && contact.name.toLowerCase().includes(query)) ||
                               (meeting.location && meeting.location.toLowerCase().includes(query)) ||
                               (meeting.notes && meeting.notes.toLowerCase().includes(query)) ||
                               (meeting.type.toLowerCase().includes(query)) ||
                               meetingNotes.some(note => 
                                   note.content.toLowerCase().includes(query) ||
                                   (note.followUp && note.followUp.toLowerCase().includes(query))
                               );
                    });
                }
                
                // Group by date for display
                const meetingsByDate = {};
                
                filteredMeetings.forEach(meeting => {
                    if (!meetingsByDate[meeting.date]) {
                        meetingsByDate[meeting.date] = [];
                    }
                    meetingsByDate[meeting.date].push(meeting);
                });
                
                // Display results in a list format instead of calendar
                if (Object.keys(meetingsByDate).length === 0) {
                    const noResults = document.createElement('div');
                    noResults.className = 'col-span-7 p-4 text-center text-gray-500 dark:text-gray-400';
                    noResults.textContent = 'No meetings found matching your search.';
                    calendarGrid.appendChild(noResults);
                    return;
                }
                
                // Create a list view of search results, sorted by date
                const dates = Object.keys(meetingsByDate).sort((a, b) => new Date(a) - new Date(b));
                
                dates.forEach(date => {
                    // Create date header
                    const dateHeader = document.createElement('div');
                    dateHeader.className = 'col-span-7 bg-gray-100 dark:bg-gray-800 p-2 font-medium';
                    dateHeader.textContent = formatDate(date);
                    calendarGrid.appendChild(dateHeader);
                    
                    // Create container for meetings on this date
                    const meetingsContainer = document.createElement('div');
                    meetingsContainer.className = 'col-span-7 p-2 space-y-2';
                    
                    // Add each meeting
                    meetingsByDate[date].forEach(meeting => {
                        const contact = getContactById(meeting.contactId);
                        const meetingEl = document.createElement('div');
                        
                        // Set background color based on meeting type and completion status
                        let bgColorClass = 'bg-purple-100 dark:bg-purple-900 dark:bg-opacity-20'; // Default for in-person
                        
                        if (meeting.type === 'Phone') {
                            bgColorClass = 'bg-green-100 dark:bg-green-900 dark:bg-opacity-20';
                        } else if (meeting.type === 'Video') {
                            bgColorClass = 'bg-blue-100 dark:bg-blue-900 dark:bg-opacity-20';
                        }
                        
                        // If completed, override with gray
                        if (meeting.completed) {
                            bgColorClass = 'bg-gray-100 dark:bg-gray-700 dark:bg-opacity-50';
                        }
                        
                        meetingEl.className = `p-3 rounded-lg ${bgColorClass} flex items-start ${meeting.completed ? 'opacity-70' : ''}`;
                        
                        // Check for notes and follow-ups
                        const hasNotes = appData.notes.some(note => note.meetingId === meeting.id);
                        const hasFollowUp = appData.notes.some(note => note.meetingId === meeting.id && note.followUp);
                        
                        // Create indicator HTML if needed
                        let indicatorsHTML = '';
                        if (hasNotes || hasFollowUp) {
                            indicatorsHTML = '<div class="ml-2 flex space-x-1">';
                            if (hasNotes) {
                                indicatorsHTML += '<span class="w-3 h-3 rounded-full bg-green-500" title="Has notes"></span>';
                            }
                            if (hasFollowUp) {
                                indicatorsHTML += '<span class="w-3 h-3 rounded-full bg-red-500" title="Has follow-up items"></span>';
                            }
                            indicatorsHTML += '</div>';
                        }
                        
                        meetingEl.innerHTML = `
                            <div class="flex-shrink-0 w-10 h-10 flex items-center justify-center rounded-full mr-3 ${meeting.type === 'Phone' ? 'bg-green-200 dark:bg-green-900' : meeting.type === 'Video' ? 'bg-blue-200 dark:bg-blue-900' : 'bg-purple-200 dark:bg-purple-900'}">
                                <i class="fas ${meeting.type === 'Phone' ? 'fa-phone' : meeting.type === 'Video' ? 'fa-video' : 'fa-users'} ${meeting.completed ? 'text-gray-500 dark:text-gray-400' : 'text-gray-700 dark:text-gray-200'}"></i>
                            </div>
                            <div class="flex-1">
                                <div class="flex justify-between">
                                    <h4 class="font-medium">${contact ? contact.name : 'Unknown'}</h4>
                                    <div class="flex items-center">
                                        <span class="text-sm text-gray-500 dark:text-gray-400">${meeting.time.substring(0, 5)}</span>
                                        ${indicatorsHTML}
                                    </div>
                                </div>
                                <p class="text-sm">${meeting.type} catch-up</p>
                                ${meeting.location ? `<p class="text-sm mt-1"><i class="fas fa-map-marker-alt mr-1 text-gray-400"></i>${meeting.location}</p>` : ''}
                            </div>
                        `;
                        
                        meetingEl.addEventListener('click', () => {
                            openMeetingDetails(meeting.id);
                        });
                        
                        meetingsContainer.appendChild(meetingEl);
                    });
                    
                    calendarGrid.appendChild(meetingsContainer);
                });
            }
            
            // Initialize calendar event listeners
            function initCalendar() {
                // Previous month button
                prevMonthBtn.addEventListener('click', () => {
                    currentMonth--;
                    if (currentMonth < 0) {
                        currentMonth = 11;
                        currentYear--;
                    }
                    renderCalendar();
                });
                
                // Next month button
                nextMonthBtn.addEventListener('click', () => {
                    currentMonth++;
                    if (currentMonth > 11) {
                        currentMonth = 0;
                        currentYear++;
                    }
                    renderCalendar();
                });
                
                // Today button
                todayBtn.addEventListener('click', () => {
                    const today = new Date();
                    currentMonth = today.getMonth();
                    currentYear = today.getFullYear();
                    renderCalendar();
                    
                    // Clear search field
                    calendarSearch.value = '';
                });
                
                // Close popup button
                closePopupBtn.addEventListener('click', () => {
                    hideMeetingPopup();
                });
                
                // View details button in popup
                popupViewDetailsBtn.addEventListener('click', () => {
                    if (selectedMeetingId) {
                        hideMeetingPopup();
                        openMeetingDetails(selectedMeetingId);
                    }
                });
                
                // Search functionality
                calendarSearch.addEventListener('input', (e) => {
                    searchCalendar(e.target.value.trim().toLowerCase());
                });
                
                // Close popup when clicking outside
                document.addEventListener('click', (e) => {
                    if (meetingPopup.classList.contains('hidden')) return;
                    
                    if (!meetingPopup.contains(e.target) && 
                        e.target.closest('#calendar-grid') === null) {
                        hideMeetingPopup();
                    }
                });
                
                // Initial render
                renderCalendar();
            }
            
            // Initialize the calendar
            initCalendar();
        }
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            setupNavigation();
            setupContactsSection();
            setupMeetingsSection();
            setupNotesSection();
            setupSuggestionsSection();
            setupMessageAnalysisSection();
            setupCalendarSection();
            populateDashboard();
        });
    </script>
</body>
</html>
